\documentclass[shownotes,aspectratio=169]{beamer}

\input{../auxiliar/tex/diapo_encabezado.tex}
\input{../auxiliar/tex/tikzlibrarybayesnet.code.tex}
 \mode<presentation>
 {
 %   \usetheme{Madrid}      % or try Darmstadt, Madrid, Warsaw, ...
 %   \usecolortheme{default} % or try albatross, beaver, crane, ...
 %   \usefonttheme{serif}  % or try serif, structurebold, ...
  \usetheme{Antibes}
  \setbeamertemplate{navigation symbols}{}
 }
 
\usepackage{todonotes}
\setbeameroption{show notes}

\newif\ifen
\newif\ifes
\newcommand{\en}[1]{\ifen#1\fi}
\newcommand{\es}[1]{\ifes#1\fi}
\estrue

%\title[Bayes del Sur]{}

\begin{document}

\color{black!85}
\large

\begin{frame}[plain,noframenumbering]
 
 \begin{textblock}{120}(03,04)
 \huge \textcolor{black!66}{Multilevel selection \\[-0.1cm] in nonergodic systems}
\end{textblock}

 %\vspace{2cm}brown
%\maketitle
\Wider[2cm]{
\includegraphics[width=1\textwidth]{../auxiliar/images/peligro_predador}
}

 \begin{textblock}{47}(123,68)
\centering \Large  \textcolor{white!55}{Cooperation}
\end{textblock}


\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{The complexity of life}\es{La complejidad de la vida}
\end{textblock}
\vspace{0.75cm}

\begin{textblock}{160}(0,26)\centering
\includegraphics[width=0.6\linewidth]{../auxiliar/images/biomass.jpg}
\\[0.1cm]
Bar-On et al. 2018
\end{textblock}


\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Linage growth}\es{Crecimiento de los linajes}
\end{textblock}
\vspace{0.75cm}

\begin{equation*}
\omega(T) = \prod_t^T f(a(t)) \onslide<3>{\approx f^T}
\end{equation*}

\pause
\vspace{0.5cm}

\begin{equation*}
f(a) =
\begin{cases}
 1.5 & a = \text{ \en{Head}\es{Cara} } \\
 0.6 & a = \text{  \en{Tail}\es{Seca} }
\end{cases}
\end{equation*}

\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Expected value}\es{Valor esperado}
\end{textblock}
\vspace{1.25cm}

\begin{equation*}
\langle \omega \rangle_t = \sum_{\omega \in \Omega_t} \omega \cdot  P(\omega) \onslide<4>{= 1.05^t}
\end{equation*}

\begin{equation*}
\begin{split}
\onslide<2->{\langle \omega \rangle_1 & = 1.5 \cdot \frac{1}{2} + 0.6 \cdot  \frac{1}{2} = 1.05} \\ 
\onslide<3->{ \langle \omega \rangle_2 &=  1.5^2 \cdot \frac{1}{4} + 2 (0.6 \cdot 1.5 \cdot \frac{1}{4} ) + 0.6^2 \cdot \frac{1}{4}= 1.05^2}
\end{split}
\end{equation*}


\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Expected value}\es{Valor esperado}
\end{textblock}
\vspace{1.25cm}


\begin{textblock}{150}(0,22)\centering
\includegraphics[width=0.5\linewidth]{../figures/pdf/ergodicity_expectedValue.pdf}
\end{textblock}


\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Individual trayectories}\es{Trayectorias individuales}
\end{textblock}
\vspace{1.25cm}

\begin{textblock}{150}(0,26)\centering
\includegraphics[width=0.45\linewidth]{../figures/pdf/ergodicity_individual_trayectories.pdf}
\includegraphics[width=0.45\linewidth]{../figures/pdf/ergodicity_individual_trayectories_longrun.pdf}
\end{textblock}


\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Individual trayectories}\es{Trayectorias individuales}
\end{textblock}
\vspace{1.25cm}


\begin{equation*}
\begin{split}
 {f}^T & = \ \lim_{T \rightarrow \infty} \omega(T) \\
\onslide<2->{ {f}  & =\left( \lim_{T \rightarrow \infty} \omega_e(T) \right)^{1/T} }\\[0.2cm]
\onslide<3->{& = \lim_{T \rightarrow \infty} f_e(\text{cara})^{n_1/T} f_e(\text{seca})^{n_2/T}} 
 \end{split}
\end{equation*}

\vspace{0.4cm}

\begin{equation*}
\onslide<4>{f = 1.5^{1/2} \cdot 0.6^{1/2} \approx 0.95}
\end{equation*}

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Cooperation}\es{Cooperación}
\end{textblock}
\vspace{1.25cm}


\centering
\scalebox{0.75}{
\tikz{

    \node[latent, minimum size=2cm ] (x1_0) {$\omega_1(t)$} ;
    \node[latent, below=of x1_0, minimum size=2cm ] (x2_0) {$\omega_2(t)$} ;

    \node[latent, right=of x1_0, minimum size=3cm ] (x1_0g) {$ \omega_1(t)\cdot f(a_1(t))$} ;
    \node[latent, right=of x2_0, minimum size=1.8cm, xshift=0.6cm , align=left] (x2_0g) {$\omega_2(t)\cdot$\\$f(a_2(t))$} ;
    
    \node[latent, right=of x1_0g, minimum size=3.8cm, yshift=-1.33cm, align=right] (x_0) {$\omega_1(t)\cdot f(a_1(t))$\\$+\omega_2(t)\cdot f(a_2(t))$ } ;
    
    \node[const, above=of x_0] (nx_0) {$\overbrace{\text{Pool}\hspace{2.5cm}\text{Share}}^{\text{\normalsize Cooperaci\'on}}$} ;
    
    \node[latent, right=of x1_0g, minimum size=2.5cm,  xshift=4.5cm] (x1_1) {$\omega_1(t+1)$ } ;
    \node[latent, below=of x1_1, minimum size=2.5cm, yshift=0.7cm] (x2_1) {$\omega_2(t+1)$ } ;
    
    \edge {x1_0} {x1_0g};
    \edge {x2_0} {x2_0g};
    \edge {x1_0g,x2_0g} {x_0};
    \edge {x_0} {x1_1,x2_1};
    
}
}


\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Cooperation}\es{Cooperación}
\end{textblock}
\vspace{1.25cm}

\centering
  \includegraphics[width=0.6\textwidth]{../figures/pdf/ergodicity_cooperation.pdf}

\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Desertion}\es{Deserción}
\end{textblock}
\vspace{1.25cm}


\centering
\scalebox{0.75}{
\tikz{

    \node[latent, minimum size=2cm ] (x1_0) {$\omega_1(t)$} ;
    \node[latent, below=of x1_0, minimum size=2cm ] (x2_0) {$\omega_2(t)$} ;

    \node[latent, right=of x1_0, minimum size=3cm ] (x1_0g) {$ \omega_1(t)\cdot f(a_1(t))$} ;
    \node[latent, right=of x2_0, minimum size=1.8cm, xshift=0.6cm , align=left] (x2_0g) {$\omega_2(t)\cdot$\\$f(a_2(t))$} ;
    
    \node[latent, right=of x1_0g, minimum size=3cm, yshift=-1.33cm, align=right] (x_0) {$\omega_1(t)\cdot f(a_1(t))$ } ;
    
    \node[const, above=of x_0] (nx_0) {$\overbrace{\text{Pool}\hspace{2.5cm}\text{Share}}^{\text{\normalsize Cooperaci\'on}}$} ;
    
    \node[latent, right=of x1_0g, minimum size=2.2cm,  xshift=4.5cm] (x1_1) {$\omega_1(t+1)$ } ;
    \node[latent, below=of x1_1, minimum size=3cm, yshift=0.7cm, align=left] (x2_1) {$\omega_1(t+1) +$ \\$ \omega_2(t)\cdot f(a_2(t))$ } ;
    
    \edge {x1_0} {x1_0g};
    \edge {x2_0} {x2_0g};
    \edge {x1_0g} {x_0};
    \edge {x_0} {x1_1,x2_1};
    \edge {x2_0g} {x2_1};
    
}
}



\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Desertion}\es{Deserción}
\end{textblock}
\vspace{1.25cm}


\centering
  \includegraphics[width=0.6\textwidth]{../figures/pdf/ergodicity_desertion.pdf}

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Objective}\es{Objetivo}
\end{textblock}
\vspace{1.25cm}


\begin{framed}
(1) Demostrar la ventaja evolutiva de la cooperación (2) mediante un modelo jerárquico bayesiano que represente selección multinivel (3) incorporando el efecto de la especialización.
\end{framed}

\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Isomorphism}\es{Isomorfismo}
\end{textblock}
\vspace{1cm}

\begin{equation*} 
 \overbrace{p(e|a) = \frac{p(a|e)\,p(e)}{\sum_i p(a|i)p(i)}}^{\text{\small \en{Bayes Theorem}\es{Teorema de Bayes}}}   \ \ \ \ \ \ \ \   \overbrace{x_e^\prime = \frac{f_e(a)\,x_e}{\sum_i f_i(a)\,x_i}}^{\text{\small Replicator dynamic}}  
\end{equation*}

\vspace{0.3cm}

\pause

\begin{align*}
\centering
 \begin{tabular}{l|l}
  Teorema de Bayes & Replicator dynamic  \\ \hline
  Prior $p(e)$ & Proporción previa $x_e$ \\ \hline
  Verosimilitud $p(a|e)$ & Fitness $f_e(a)$ \\ \hline
  Evidencia $\sum_i p(a|i)p(i)$ & Población total $\sum_i f_i(a)\,x_i$ \\ \hline
  Posterior $p(e|a)$ & Proproción posterior $x_e^\prime$ \\ \hline
 \end{tabular}
\end{align*}


\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Base model}\es{Modelo base}
\end{textblock}
\vspace{1cm}

\begin{equation*}
f_{e^*}(a) \propto  P(a|e^*) = \begin{cases}
 \frac{1.5}{1.5+0.6} & a = 1 \\
 \frac{0.6}{1.5+0.6} & a = 0
  \end{cases}
  \approx
\begin{cases}
 0.71 & a= 1 \\
 0.29 & a= 0
\end{cases}
\end{equation*}

\pause

\vspace{0.3cm}

\begin{equation*}
P(a|e) = \text{B}(a|e) = (1-e)^{(1-a)} \cdot e^a 
\end{equation*}

\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Base model}\es{Modelo base} $M_0$
\end{textblock}
\vspace{1.3cm}


\centering
\tikz{
    \node[latent] (e) {$e$};
    \node[const, right=of e, xshift=0.2cm] (en) {\ $p(e)=\text{Beta}(1,1)$};
    \node[const, left=of e, xshift=-0.4cm] (ne) {Estrategias: \ \ \ };

    \node[latent, below=of e] (r) {$a^t$};
    \node[const, right=of r, xshift=0.2cm] (rn) {$P(a|e) = \text{Bernoulli}(a|e)$};
    \node[const, left=of r, xshift=-0.4cm] (nr) {Aptitud: \ \ \ };
    
    \plate {observaciones} {(r)} {$ 1 \leq t \leq T$}; 
    
    \edge {e} {r};
    }

\vspace{0.2cm}
\pause

\includegraphics[width=0.32\textwidth]{../figures/coin1.pdf}
\includegraphics[width=0.32\textwidth]{../figures/coin2.pdf}   
\includegraphics[width=0.32\textwidth]{../figures/coin3.pdf}
    
\vspace{-0.7cm}
\pause    
    
    
\begin{equation*}
P(a(1\dots T), e | M_0) = \prod_t^T P(a(t)|e) \approx  P(a=1|e)^{p^*} P(a=0|e)^{1-p^*}
\end{equation*}

\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General model}\es{Modelo general} $M_{e,n}$
\end{textblock}
\vspace{1.5cm} \centering

\tikz{
    
    \node[latent, minimum size=0.9cm] (e1) {$s^{t}$};
    \node[latent, right=of e1, minimum size=0.9cm] (e2) {$s^{t+1}$};
    \node[const, right=of e2] (e2n) {$P(s^{t+1}|s^{t}) = \frac{1}{n}$};
    \node[const, right=of e2, yshift=-1cm] (e2n) {$P(s^{0}) = \text{Prior}$};
    \node[const, right=of e2, yshift=-2cm] (e2n) {$P(a_s^t|e) = \text{Bernoulli}(a_s^t|e)$};
    
    \node[latent, below=of e1, minimum size=0.9cm] (a) {$a^{t}$};
    \edge {e1} {a,e2};
    }

    
\begin{equation*}
\begin{split}
\onslide<2->{P(s^{t+1}, a^t | M_{n,e} ) &=\frac{1}{3} \text{Prior}^t  \overbrace{P(a_1^t|e)}^{\hfrac{\text{Likelohood}}{\text{individual 1}}} + \frac{1}{3} \text{Prior}^t  \overbrace{P(a_2^t|e)}^{\hfrac{\text{Likelohood}}{\text{individual 2}}}  + \frac{1}{3} \text{Prior}^t  \overbrace{P(a_3^t|e)}^{\hfrac{\text{Likelohood}}{\text{individual 3}}}}  \\
\onslide<3->{&= \text{Prior}^t \underbrace{(\frac{1}{3} P(a_1^t|e) + \frac{1}{3} P(a_2^t|e) + \frac{1}{3} P(a_3^t|e))}_{f(a|e,n=3)\text{ fitness cooperativo}} = \text{Prior}^{t+1}}
\end{split}
\end{equation*}

\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General model}\es{Modelo general} $M_{e,n}$
\end{textblock}
\vspace{1cm} \centering

%
\only<1>{
\vspace{0.5cm}
\begin{equation*}
f(a|e,n=3) =
\begin{cases}
(1-e) & \text{ si } \texttt{sum}(a) = 0 \\
\frac{1}{3} e + \frac{2}{3} (1-e)  & \text{ si } \texttt{sum}(a) = 1 \\
\frac{2}{3} e + \frac{1}{3} (1-e)    & \text{ si } \texttt{sum}(a) = 2 \\
e & \text{ si } \texttt{sum}(a) = 3
\end{cases}
\end{equation*}
%
}


\onslide<2->{
\begin{equation*}\label{eq:fitness_cooperador}
f(a|e,n) = \frac{x}{n} e + \frac{n-x}{n}(1-e) \ \ \ \ \ \ \ \ \text{ con } x = \texttt{sum}(a)
\end{equation*}
}

\vspace{-0.8cm}

\onslide<3->{
\begin{equation*}
P(s^{T+1}, \bm{a}|e,n) = \text{Prior}^0 \prod^T_{t=1} f(a^t|e,n) \onslide<4->{\approx \overline{f}_{e,n}^T}
\end{equation*}
}

\vspace{-0.8cm}


\onslide<5->{
\begin{equation*}
\overline{f}_{e,n} = \prod_{a=0}^n f(a|e,n)^{\text{Binomial}(x|n,p^*)}
\end{equation*}
}


\vspace{-0.8cm}

\onslide<6->{
\begin{equation*}
\lim_{n \rightarrow \infty} \overline{f}_{e,n} =  p^* \, e + (1 - p^*) \, (1-e)
\end{equation*}
}


\end{frame}

\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General model}\es{Modelo general} $M_{e,n}$
\end{textblock}
\vspace{1.5cm} \centering


\includegraphics[width=0.66\textwidth]{../figures/pdf/tasa-temporal-0.pdf} \hspace{1cm}
    

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General model}\es{Modelo general} $M_{e,n}$
\end{textblock}
\vspace{1.5cm} \centering


\includegraphics[width=0.66\textwidth]{../figures/pdf/tasa-temporal-1.pdf} \hspace{1cm}
    

\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General model}\es{Modelo general} $M_{e,n}$
\end{textblock}
\vspace{1.5cm} \centering


\includegraphics[width=0.66\textwidth]{../figures/pdf/tasa-temporal-2.pdf} \hspace{1cm}
    

\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{General mixed model}\es{Modelo general mixto} $M_{e,n,N}$
\end{textblock}
\vspace{1.3cm} \centering


\tikz{    
    \node[latent, minimum size=0.9cm] (e1) {$s^{t}$};
    \node[latent, right=of e1, minimum size=0.9cm] (e2) {$s^{t+1}$};
    \node[const, right=of e2] (e2n) {$P(s^{t+1}|s^{t}) = \begin{cases}\frac{1}{N}  & s^t \leq n \\ \mathbb{I}(s^{t+1}=s^t) & s^t > n\end{cases}$};
    \node[const, right=of e2, yshift=-1cm] (e2n) {$P(s^{0}) = \text{Prior}$};
    \node[const, right=of e2, yshift=-2cm] (e2n) {$P(a_s^t|e) = \text{Bernoulli}(a_s^t|e)$};
    
    \node[latent, below=of e1, minimum size=0.9cm] (a) {$a^{t}$};
    \edge {e1} {a,e2};
}

\pause
\vspace{0.4cm}


\begin{align*}
\centering
P(M|e=0.71,N=2) = \begin{tabular}{|c|c|c|c|}
        \hline
        $n=0$ & $n=1$ & $n=2$ \\ \hline
        $1/4$ & $1/2$ & $1/4$ \\ \hline
\end{tabular}
\end{align*}

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Model selection}\es{Selección de modelo} $M_{e,n,N}$
\end{textblock}
\vspace{1.5cm} \centering

\includegraphics[width=0.66\textwidth]{../figures/pdf/multilevel-selection-6.pdf}\hspace{1cm}
    

\end{frame}


\begin{frame}[plain]

\centering
  \includegraphics[width=0.4\textwidth]{../auxiliar/images/pachacuteckoricancha.jpg}
\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Growth rate for mixed populations}\es{Tasa de crecimiento para poblaciones mixtas} $M_{e,n,N}$
\end{textblock}
\vspace{1.3cm} \centering

\begin{equation*}
P(s=1,a|e,n,N) = \frac{x}{N} e + \frac{n-x}{N}(1-e) = \frac{n}{N} f(a|e,n)
\end{equation*}

\vspace{0.5cm}

\begin{equation*}
P(s=N, \bm{a}^{:t}|e,n,N) =
\begin{cases}
 P(a_s^1|e) & \ \  t=1 \\
 (P(\bm{a}^{:t-1},s=N|e,n,N) + P(\bm{a}^{:t-1}, s=1|e,n,N)) p(a_s^t|e) & \ \  t>1
\end{cases}
\end{equation*}


\end{frame}



\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Growth rate for mixed populations}\es{Tasa de crecimiento para poblaciones mixtas} $M_{e,n,N}$
\end{textblock}
\vspace{1.3cm} \centering

\includegraphics[width=0.66\textwidth]{../figures/pdf/multilevel-selection-5.pdf}
    

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Fitness for mixed populations}\es{Fitness para poblaciones mixtas} $M_{e,n,N}$
\end{textblock}
\vspace{1.3cm} \centering

\includegraphics[width=0.66\textwidth]{../figures/pdf/multilevel-selection-7.pdf}

\end{frame}


\begin{frame}[plain]
\begin{textblock}{160}(0,4)
 \centering \LARGE
\en{Fitness for mixed populations}\es{Fitness para poblaciones mixtas} $M_{e,n,N}$
\end{textblock}
\vspace{1.3cm} \centering


\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{../figures/pdf/multilevel-selection-1.pdf}
    \caption{9/9}
    \label{fig:multilevel-selection-1}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{../figures/pdf/multilevel-selection-2.pdf}
    \caption{8/9}
    \label{fig:multilevel-selection-2}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{../figures/pdf/multilevel-selection-3.pdf}
    \caption{7/9}
    \label{fig:multilevel-selection-3}
    \end{subfigure}
\end{figure}
%

\end{frame}


\end{document}



