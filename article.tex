\documentclass[a4paper,10pt]{article}
\usepackage[utf8]{inputenc}
\input{auxiliar/tex/encabezado.tex}
\input{auxiliar/tex/tikzlibrarybayesnet.code.tex}
\newif\ifen
\newif\ifes
\newcommand{\en}[1]{\ifen#1\fi}
\newcommand{\es}[1]{\ifes#1\fi}
\estrue

\newtheorem{conclution}{\en{Conclution}\es{Conclusión}}%[section]
\newtheorem{objective}{\en{Objective}\es{Objetivo}}%[section]



%opening
\title{Multilevel selection in nonergodic systems: the evolutionary advantage of cooperation and especialization.}
\author{Gustavo Landfried}

\begin{document}

\maketitle

\begin{abstract}
El crecimiento de la vida depende de secuencias multiplicativas de probabilidades de superviencia y reproducción.
Como consecuencia de la no-ergodicidad de este proceso, las fluctuaciones tienen un efecto negativo en la tasa de crecimiento individual: un único cero en la secuencia es suficiente para generar una extinción irreversible.
Compartir recursos permite reducir las fluctuaciones, lo que produce un aumento de la tasas de crecimiento a largo plazo de todos los individuos.
En este trabajo mostramos que, si bien las estrategias que evitan compartir recursos pueden invadir por selección natural poblaciones enteramente cooperadoras, tal comportamiento aumenta al mismo tiempo sus propias fluctuaciones, reduciendo su propia tasa de crecimiento a largo plazo sin necesidad de introducir castigos.
Utilizando la equivalencia entre la selección multinivel y la inferencia en modelos jerárquicos bayesianos, mostramos que las estrategias incondicionalmente cooperadoras, sin ser evolutivamente estables al interior de los grupos, se ven favorecidas evolutivamente a través de la selección grupal.
A su vez, mostramos que las estrategias individualmente mal adaptadas al ambiente (especialistas) gracias a la cooperación en pequeña escala consigen superar tanto a las estrategias bien adaptas individualmemte (generalistas), como a sus grupos cooperativos de tammaño infinito.
La ventaja evolutiva de la cooperación y la especialización es consecuencia de la no-ergodicidad de los procesos multiplicativos a los que está sujeto la vida, por lo que ésta debe ser considerada la primera causa de las transiciones evolutivas mayores.
\end{abstract}

\section{Introducción}

En el último tercio de la historia del Universo, en algún momento hace aproximadamente 4000 millones de años, apareció en la tierra una forma de organización de la materia capaz de auto-replicarse.
El crecimiento de estos linajes siguieron procesos multiplicativos y ruidosos: secuencias de probabilidades de supervivencia y reproducción.
Los errores producidos durante la replicación diversificaron las formas de vida, y las tasas de crecimiento de las diferentes estrategias favorecieron a aquellas mejor adaptadas al ambiente.
Desde aquel momento hasta ahora la vida adquirió una extraordinaria complejidad.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.65\textwidth}
    \includegraphics[width=\linewidth]{auxiliar/images/biomass.jpg}
    \end{subfigure}
    \caption{
	Distribución actual de la biomasa en la tierra estimada por Bar-On et al.~\cite{barOn2018-biomass}.
    }
    \label{fig:biomass}
\end{figure}
%
Esta complejidad es consecuencia de una serie de transiciones evolutivas~\cite{maynardSmith1995-majorTransitions} en las que las entidades capaces de replicarse de forma independiente, cediendo algo de valor a las otras, pasan a formar unidades evolutivas de nivel superior.
Algunos ejemplos paradigmáticos son la transición de las moléculas replicantes a las protocélulas, la endosimbiosis de las mitocondrias y los plastos por parte de las células eucariotas, la aparición de los organismos multicelulares.
¿Cómo se explica esta tendencia permanente de la vida en favor de la agregación cooperativa y la especialización?

En evolución, el crecimiento de una estrategia $e$ en el tiempo, $\omega_e(t)$, esta gobernado por una secuencias estocástica de tasas de supervivencia y reproducción $f_e(\cdot)$ dependientes de un ambiente aleatorio $a$,
%
\begin{equation} \label{eq:modelo_exponencial}
\omega_e(T) = \prod_t^T f_e(a(t))
\end{equation}
%
donde $a(t)$ representa el estado del ambiente en el tiempo $t$.
Por ejemplo, supongamos que la naturaleza lanza una moneda, si sale cara la población se reproduce 50\% y si sale seca sobrevive 60\%.
\begin{equation} \label{eq:estrategia_base}
f_e(a) =
\begin{cases}
 1.5 & a = \text{ Cara } \\
 0.6 & a = \text{ Seca }
\end{cases}
\end{equation}
Según el modelo estándar de evolución, conocido como \emph{replicator dynamic} \cite{taylor1978-replicatorDynamic, schuster1983-replicatorDynamics, hofbauer2003-evolutionaryGameDynamics}, el cambio de la proporción de una estrategia en la población, $x_e$, está determinado por su tasa de crecimiento caracterísitica $f_e$,
\begin{equation} \label{eq:replicator_dynamic}  \tag{Replicator dynamic}
x_e^\prime = \frac{x_e f_e}{X}
\end{equation}
donde $X=\sum_i x_i f_i$, el tamaño total de la población, actúa como constante de normalización.
¿Pero cuál es la tasa de crecimiento característica, $f_e$?
Su estimación requiere considerar explícitamente la variablidad del ambiente, $a$, y el tipo de proceso que genera esa variabilidad.

% Parrafo

Buena parte de la literatura en evolución considera que la estimación correcta se obtiene mediante el valor esperado de los recursos en el tiempo, $\langle \omega_e(t) \rangle$.
Sea $\Omega_t$ el conjunto de todas las posibles trayectorias de los recursos en el tiempo $t$, el valor esperado se obtiene promediando los estados $\omega \in \Omega_t$ por la probabilidad de que ocurran $P(\omega)$
\begin{equation}
\langle \omega_e \rangle_t = \sum_{\omega \in \Omega_t} \omega \cdot  P(\omega)
\end{equation}

% Parrafo

En el ejemplo de la moneda, el valor esperado en los dos primeros pasos temporales es, 
%
\begin{equation}
\begin{split}
\langle \omega_e \rangle_1 & = 1.5 \cdot \frac{1}{2} + 0.6 \cdot  \frac{1}{2} = 1.05 \\ 
\langle \omega_e \rangle_2 &=  1.5^2 \cdot \frac{1}{4} + 2 (0.6 \cdot 1.5 \cdot \frac{1}{4} ) + 0.6^2 \cdot \frac{1}{4}= 1.05^2
\end{split}
\end{equation}
%
Es decir, la tasa de crecimiento estimada según el valor esperado es de $5\%$ por cada paso temporal, $\langle \omega \rangle_t = 1.05^t$.
Y efectivamente eso es lo que ocurre con el promedio de las trayectoria individuales, $\omega_e(t)$, cuando la población es suficientemente grande,
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_expectedValue.pdf}
    \end{subfigure}
    \caption{
    Promedio de los recursos individuales en el tiempo para diferentes tamaños de la población, en escala logarítimica.
    A medida que aumentamos el tamaño de la población, el promedio se acerca al valor esperado $\langle \omega \rangle_t = 1.05^t$.
    }
    \label{fig:cpr_individual}
\end{figure}
%
Sin embargo, el valor esperado no representa lo que lo le ocurre a los agentes en el tiempo. 
Individualmente, todas las trayectorias pierden a largo plazo a una tasa cercana al 5\%.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_individual_trayectories.pdf}
    \caption{}
    \label{fig:ergodicity_individual_trayectories}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_individual_trayectories_longrun.pdf}
    \caption{}
    \label{fig:ergodicity_individual_trayectories_longrun}
    \end{subfigure}
    \caption{
    La recta negra representan el valor esperado.
    Figura \ref{fig:ergodicity_individual_trayectories}: tamaño de los recursos individuales en el tiempo, $ \log(\omega(t))$.
    Figura \ref{fig:ergodicity_individual_trayectories_longrun}: con suficiente tiempo todas las trayectorias individuales se pegan a la recta azul. 
    }
    \label{fig:cpr_individual}
\end{figure}
%
%La relación entre el valor esperado y lo que le ocurre a los agentes individuales en el tiempo es un problema bien conocido en mecánica estadística.
Cuando lo que le ocurre a los agentes individuales en el tiempo puede describirse mediante el valor esperado de los estados del sistema se dice que el proceso es ergódico~\cite{peters2019-ergodicityEconomics}.
Sin embargo, las condiciones para que esto se cumple son muy restrictivas.
En particular, la dinámica evolutiva está gobernada por un procesos multiplicativos (eq.~\ref{eq:modelo_exponencial}).
En el ejemplo de la moneda puede expresarse como,
%
\begin{equation}
\omega_e(T) = \prod^T_{t=1} f_e(a(t)) = f_e(\text{cara})^{n_1} f_e(\text{seca})^{n_2}
\end{equation}
%
donde $n_1$ y $n_2$ representa la cantidad de ocurrencias de $f_e(\text{cara})$ y $f_e(\text{seca})$, con $n_1 + n_2 = T$.
Las trayectorias observadas en la figura \ref{fig:ergodicity_individual_trayectories} son variables, pero cuanto más tiempo observemos el sistema más suave se vuelven esas líneas (figura \ref{fig:ergodicity_individual_trayectories_longrun}).
En el límite, $T \rightarrow \infty$ todas las trayectorias individuales estarán determinadas por la misma tasa de crecimiento caracterísitica ${f_e}$, por el que se multiplican los recursos $\omega_e(t)$ en cada iteración.
\begin{equation} \label{eq:geometric_mean}
\begin{split}
\lim_{T \rightarrow \infty} \omega_e(T) & = {f_e}^T \\
\left( \lim_{T \rightarrow \infty} \omega_e(T) \right)^{1/T} & =  {f_e} \\
\lim_{T \rightarrow \infty} f_e(\text{cara})^{n_1/T} f_e(\text{seca})^{n_2/T} & 
 \end{split}
\end{equation}
Donde las frecuencias $\frac{n_1}{T}$ y $\frac{n_2}{T}$ en el límite $T \rightarrow \infty$ son iguales a las probabilidades de ocurrencia de los estados del sistema.
Por lo tanto, la mejor estimación de la tasa de crecimiento es,
\begin{equation}
{f_e} = (1.5 \cdot 0.6)^{1/2} \approx 0.95
\end{equation}
%
Esta fórmula, que permite computar la tasa de crecimiento a largo plazo de las trayectorias individuales, ha sido usada previamente en la literatura de evolución bajo el nombre de \emph{media geométrica}~\cite{dempster1955-geometricMean}.
Una propiedad importante de la media geométrica es que su valor siempre es menor al valor esperado (o media aritmética).
Esto se debe a que en los procesos multiplicativos los impactos físicos de las pérdidas suelen ser más fuertes que los de las ganancias.
En el extremo, un único cero en la productoria alcanza para generar su extinción.

% Decimos que un proceso es ergódico si se cumple que,
% \begin{equation}
%  \underbrace{\lim_{T \mapsto \infty} \frac{1}{T} \sum_{t=1}^T \omega(t)}_{\text{Media temporal}}  = \underbrace{\sum_{\omega} \omega \cdot p(\omega)}_{\text{Media de estados}}
% \end{equation}
% 

\subsection{Cooperacion}

%En los procesos no-ergódicos, las fluctuaciones tienen un efecto negativo en la tasa de crecimiento individual a largo plazo, pero no en la tasa de crecimiento del valor esperado.
Dado que en los procesos multiplicativos la varianza realmente importa, una forma eficaz de reducirla es compartir los riesgos~\cite{yaari2010-cooperationEvolution, peters-cooperation2019.03.04}.
%Parafraseando a Den Boer~\cite{denBoer1968-spreadingRisk}, la  supervivencia de una población depende de la distribución del riesgo dentro de la población y entre las poblaciones de diferentes especies.
Ole Peters~\cite{peters-cooperation2019.03.04} considera una estrategia cooperativa sencilla, repartir los recursos en partes iguales luego de cada iteración, y analiza la consecuencias que tiene sobre la tasa de crecimiento de los agentes.
%
\begin{figure}[H]
\centering
\scalebox{0.75}{
\tikz{

    \node[latent, minimum size=2cm ] (x1_0) {$\omega_1(t)$} ;
    \node[latent, below=of x1_0, minimum size=2cm ] (x2_0) {$\omega_2(t)$} ;

    \node[latent, right=of x1_0, minimum size=3cm ] (x1_0g) {$ \omega_1(t)\cdot f_e(a_1(t))$} ;
    \node[latent, right=of x2_0, minimum size=1.8cm, xshift=0.6cm , align=left] (x2_0g) {$\omega_2(t)\cdot$\\$f_e(a_2(t))$} ;
    
    \node[latent, right=of x1_0g, minimum size=3.8cm, yshift=-1.33cm, align=right] (x_0) {$\omega_1(t)\cdot f_e(a_1(t))$\\$+\omega_2(t)\cdot f_e(a_2(t))$ } ;
    
    \node[const, above=of x_0] (nx_0) {$\overbrace{\text{Pool}\hspace{2.5cm}\text{Share}}^{\text{\normalsize Cooperaci\'on}}$} ;
    
    \node[latent, right=of x1_0g, minimum size=2.5cm,  xshift=4.5cm] (x1_1) {$\omega_1(t+1)$ } ;
    \node[latent, below=of x1_1, minimum size=2.5cm, yshift=0.7cm] (x2_1) {$\omega_2(t+1)$ } ;
    
    \edge {x1_0} {x1_0g};
    \edge {x2_0} {x2_0g};
    \edge {x1_0g,x2_0g} {x_0};
    \edge {x_0} {x1_1,x2_1};
    
}
}
\caption{Estrategia cooperativa. Los agentes comienzan con los mismos recursos iniciales. Luego crecen independientemente de acuerdo con la ecuaci\'on \ref{eq:estrategia_base}. Luego cooperan poniendo sus recursos en un fondo común, que finalmente es dividio en partes iguales.}
\label{fig:protocolo}
\end{figure}

Las poblaciones enteramente cooperadoras reducen sus fluctuaciones, lo que genera una aumento en la tasa de crecimiento de todos sus miembros.
En la figura \ref{fig:ergodicity_cooperation} mostramos la trayectoria de un agente cooperador en una población de tamaño 33.
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_cooperation.pdf}
    \end{subfigure}
    \caption{
    Los recursos de un individuo de una población con 33 agentes que comparten su riqueza luego de cada iteración (recta verde), se pega al valor esperado (recta negra).
    Como referencia visual, dejamos la tasa de crecimiento temporal individual caracterísitica (recta azul).
    }
    \label{fig:ergodicity_cooperation}
\end{figure}
%
\paragraph{Conclusión Ole Peters} (La ventaja de la cooperación)\textbf{.} Mediante la cooperación total, todos los individuos logran acceder a tasas de crecimiento equivalentes al promedio de estados del sistema, que en los sistemas no-ergódicos es siempre superior que el promedio temporal que obtienen las estrategias individuales. \\

% Parrafo

Ole Peters considera que el aumento en la tasa de crecimiento es argumento suficiente para demostrar la ventaja evolutiva de la cooperación, lo que propone como principal explicación de las transiciones evolutivas.
Sin embargo no considera el problema de la deserción, quien dice ``our cooperators are unable to break the cooperative pact''.
No parece ser un problema menor, teniendo en cuenta la tentación que podría significar dejar de aportar al fondo común mientras se siguen recibiendo los beneficios de este.
Además, tampoco analiza las consecuencias que la cooperación tiene sobre la especiliazión, un elemento fundamental para explicar las transiciones evolutivas.

\subsection{Estabilidad evolutiva}

Para ejemplificar el problema de la estabilidad evolutiva de la cooperación en este sistema, analicemos las tasas de crecimiento de las estrategias cooperadora y desertora en poblaciones mixtas.
La población más chica posible está compuesta por dos agentes.
En este caso las tasas de crecimiento temporal caracterísitica para las diferentes estrategias son (demostraciones en la sección Resultados):
%
\begin{equation}
   f(\cdot,\cdot) = \bordermatrix{ & C & D \cr
      C & \approx 1.0 & \approx 0.47 \cr
      D & \approx 0.95 & \approx 0.95 } 
\end{equation}
%
El primer agente que ``decida'' desertar unilateralmente va a ver reducida su tasa de crecimiento de $f(C,C) = 1.0$ a $ f(D,C) = 0.95$.
% 
\begin{conclution}[La no necesidad de castigos]
Sin necesidad de introducir castigos, las estrategias desertoras afectan negativamente su tasa de crecimiento a largo plazo a causa de su propio comportamiento, pues al evitar compartir sus recursos generan un aumento de sus fluctuaciones.
\end{conclution}

Esto parecería apoyar la idea de Ole Peters de que la cooperación no es altruista sino que está impulsada por el interés personal\footnote{
La estructura de pagos coinicide con la matriz de pagos del Stag-Hunt. Sin embargo, los análisis que llegan a la conclusión de que las poblaciones enteramente cooperadoras son evolutivamente estables se basan en dinámicas aditivas en poblaciones infinitas, apartándose del modelo estandar de crecimiento exponencial.}.
Sin embargo para la teoría de la evolución la frecuencia de los estrategias en la población depende, no del valor absoluto de la tasa de crecimiento, sino de la diferencia respecto de las tasas de crecimiento de las otras estrategias en la población.
Por más que la mutua cooperación ofrezca una tasa de crecimiento mayor que la deserción unilateral ($f(C,C) = 1.00 > 0.95 = f(D,C)$), un mutante desertor invadirá evolutivamente la población debido a que su tasa de crecimiento será mayor a la del agente cooperador ($f(D,C) = 0.95 > 0.47 = f(C,D)$). 

\begin{conclution}[Estabilidad evolutiva nivel 1]
Esto quiere decir que las estrategias cooperadoras no son evolutivamentes estables al interior de las poblaciones.
\end{conclution}

\subsection{Objetivos}

Ole Peters pretende dar una explicación fundamental de las transiciones evolutivas, sin explicar por qué las estrategias cooperadoras están favorecidas evolutivamente, sin ofrecer una explicación de la especialización. 
En este trabajo pretendemos dar respuesta a ambos puntos, de modo de aportar apoyar el argumento original de Ole Peters.

La idea general de que las grandes transiciones evolutivas involucra selección tanto a nivel individual como a nivel grupal, está ampliamente aceptada.
Para verificar si efectivamente las estrategias cooperativas se ven favorecidas por la evolución, como propone Ole Peters, será necesario entonces hacer un análisis multinivel.

A su vez, el co-autor del concepto de transiciones evolutivas \cite{szathmary1995-evolutionaryTransitions, szathmary2015-evolutionaryTransitions}, recientemente propuso analizar la evolución de las poblaciones sujetas a selección multinivel mediante modelos jerárquicos bayesianos~\cite{czegel2019-bayesianEvolution}.
Más allá de la popuesta, Czegel, Zachar y Szathmary~\cite{czegel2019-bayesianEvolution} no logran ofrecer un modelo jerarquico bayesiano que represente selección multinivel, sus ejemplos son sólo pictóricos.

La utilización de inferencia Bayesiana para resolver la pregunta acerca de la estabilidad evolutiva de las estrategias cooperadoras bajo selección multinivel está justificada en tanto existe un isomorfimos entre la teoría de la probabilidad (teormea de Bayes) y la teoría de la evolución (replicator dynamic)~\cite{harper2009-replicatorAsInference,shalizi2009-replicatorAsInference}.

\paragraph{Objetivos:}
(1) Demostrar la ventaja evolutiva de la cooperación bajo procesos multiplicativos y ruidosos (2) mediante un modelo jerárquico bayesiano que represente la evolución de las poblaciones y las estrategias bajo selección multinivel (3) incorporando el efecto de la especialización.

\section{Metodología}

En esta sección presentamos el ismorfismo entre la teoría de la probabilidad y la evolución.
En la sección resultados utilizamos modelos bayesianos para resolver los problemas evolutivos.

\subsection{Teoría de la probabilidad}

La teoría de la probabilidad es el enfoque más utilizado en la actualidad para tratar la incertidumbre.
Sus reglas han sido derivadas formalmente a partir de sistemas axiomáticos conceptualmente distintos e independientes entre sí~\cite{halpern2017-RAU2}, lo cual es uno de los punto fuertes a su favor.
Pero quizás más importante sea que su aplicación estricta maximiza la incertidumbre dada la información empírica (datos) y formal (modelos causales)~\cite{jaynes2003-bookProbabilityTheory}, fuente de validación de las proposiciones de las ciencias empíricas.

Toda la teoría de la probabilidad puede resumirse en dos reglas: la~\ref{eq:sum_rule} y la~\ref{eq:product_rule}.
La \ref{eq:sum_rule} afirma que cualquier distribuci\'on marginal se puede obtener integrando o sumando la distribuci\'on conjunta.
\begin{equation} \label{eq:sum_rule}
 \tag{\en{sum rule}\es{regla de la suma}}
 P(x) = \sum_{y} P(x,y) \ \ \ \ \ \text{or} \ \ \ \ \ p(x) = \int p(x,y) \, dy
\end{equation}
Donde $P(\cdot)$ y $p(\cdot)$ representan distribuciones de probabilidad discretas y continuas respectivamente.
Por su parte, la \ref{eq:product_rule} se\~nala que cualquier distribuci\'on conjunta puede ser expresada como el producto de distribuciones condicionales uni-dimensionles.
\begin{equation}\label{eq:product_rule}
\tag{\en{product rule}\es{regla del producto}}
 p(x,y) = p(x|y) p(y)
\end{equation}
De la regla del producto obtenemos inmediatamente el~\ref{eq:bayes_theorem},
\begin{equation}\label{eq:bayes_theorem}
\tag{\en{Bayes' theorem}\es{teorema de Bayes}}
 p(y|x) = \frac{p(x|y)p(y)}{p(x)}
\end{equation}
La creencia a posteriori no es más que la creencia a priori que continúa siendo compatible con los datos.
%El \ref{eq:bayes_theorem} actualiza las creencia maximizando la incertidumbre luego de haber incorporado la información provista por el modelo y los datos.

\subsection{Isomorfismo entre las teorías de la evolución y la probabilidad.}

Existe un isomorfismo entre las ecuaciones fundamentales de la teoría de la evolución (replicator dynamic) y la teoría de la probabilidad (teorema de bayes),

\begin{equation} 
 p(e|a) = \frac{p(a|e)\,p(e)}{p(a)}   \ \ \ \ \ \ \ \   x_e^\prime = \frac{f_e(a)\,x_e}{X}  
\end{equation}
%
donde $e$ es la estrategia, $a$ el comportamiento exitoso. 
El isomorfimo ente la inferecia bayesiana y la evolución nos permite traducir un problema en términos del otro.
%
\begin{align*}
\centering
 \begin{tabular}{l|l}
  Teorema de Bayes & Replicator dynamic  \\ \hline
  Prior $p(e)$ & Proporción previa $x_e$ \\ \hline
  Verosimilitud $p(a|e)$ & Fitness $f_e(a)$ \\ \hline
  Evidencia $p(a)$ & Población total $X$ \\ \hline
  Posterior $p(e|a)$ & Proproción posterior $x_e^\prime$ \\ \hline
 \end{tabular}
\end{align*}

Para traducir el fitness en términos de probabilidades necesitamos normalizar su valor para que sume 1.
Luego, la estrategia original propuesta por Ole Peters tiene el siguiente likelihood,
%
\begin{equation}
f_e(a) \propto  P(a|e) = \begin{cases}
 \frac{1.5}{1.5+0.6} & a = 1 \\
 \frac{0.6}{1.5+0.6} & a = 0
  \end{cases}
  \approx
\begin{cases}
 0.71 & a= 1 \\
 0.29 & a= 0
\end{cases}
\end{equation}
%
Esta es solo una estrategia particular.
Una forma general de representar todo el espacio de estrategias es mediane la distribución Bernoulli.
%
\begin{equation}
P(a|e) = \text{B}(a|e) = (1-e)^{(1-a)} \cdot e^a 
\end{equation}
%
con $a \in \{0,1\}$.
La distribución Binomial, por su parte, permite representar de forma compacta una secuencia de observaciones, donde $a$ representa ahora la cantidad total de éxitos obtenidas en $n$ eventos, $a \in \{0, \dots, n\}$.
%Para determinar cuál de todas las estrategia se ve favorecida por la evolución debemos definir la proproción inicial de las estrategias mediante una distribución de probabilidad a priori. 
Si comenzamos con un prior uniforme, el posterior tiene solución analítica (pertenecerá a la distribución Beta).
De esta forma extendemos el ejemplo propuesto por Ole Peters mediante el siguiente modelo bayesiano.
%
\begin{figure}[H]
\centering
\tikz{
    \node[latent] (e) {$e$};
    \node[const, right=of e] (en) {\ $p(e)=\text{Beta}(\alpha,\beta)$};
    \node[const, left=of e] (ne) {Estrategias: \ \ \ };
    
    
    \node[latent, below=of e] (r) {$a$};
    \node[const, right=of r] (rn) {$P(a|e,T) = \text{Binomial}(a|T,e)$};
    \node[const, left=of r] (nr) {Aptitud: \ \ \ };
    
    \edge {e} {r};
    }
\caption{Representación bayesiana de un sistema evolutivo compuesto únicamente por estrategias desertoras, basado en el juego propuesto por Ole Peters.}
\label{fig:modelo_beta_binomial}
\end{figure}
%
Este modelo nos permitirá analizar la estabilidad evolutiva del espacio de estrategias desertoras. 
Supongamos que la moneda está sesgada de modo que el $0.71$ de las veces sale cara y el $0.29$ sale seca.
En las siguientes figuras mostramos cómo cambia la proporción de las estrategias a medida que agregamos observaciones al modelo.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin1.pdf}
    \caption{$T = 0$}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin2.pdf}
    \caption{$T = 10$}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin3.pdf}
    \caption{$T = 10^7$}
    \end{subfigure}
    \caption{Densidad (eje y) de las diferentes estrategias desertoras (eje x) a medida que avanza el juego ($T=0, \, T=10, \, T=10^7$).}
    \label{fig:estrategias_individuales}
\end{figure}

El proceso evolutivo selecciona las estrategias individuales que mejor adaptadas están al ambiente.
Cuando el ambientes genera los estados con una probabilidad de $p*=0.71$, entonces la estrategia individual mejor adaptada es la que en cada ronda apuesta $0.71$ de sus recursos al ambiente $a=1$, y $0.29$ de sus recursos al ambiente $a=0$.

% Parrafo

El ejemplo de Ole Peters supone que la moneda no está sesgada.
En este contexto, la estrategia utilizada por él para mostrar la ventaja de la cooperación no es la que está mejor adaptada en términos individuales.
¿Las estrategias individuales que mejor se adaptaron al ambiente tienen la misma tasa de crecimiento temporal que la de los grupos cooperativos?
¿Que ocurre cuando la probabilidad del ambiente estocástico varía? 
¿Será que si la probabilidad del ambiente no cambia, no hay ninguna ventaja a favor de la cooperación?
Responderemos estas y otras preguntas en la siguiente sección.
%Si ese fuera el caso, un pequeño costo asociado a la coordinación haría generaría una ventaja a favor de las estrategias individuales.
%Al menos en ambientes estocásticos estables, que mantinen 

\section{Resultados}

En esta sección analizaremos si efectivamente existe alguna ventaja evolutiva de la cooperación.
Esta pregunta permanece abierta por dos motivos.
Por un lado, hemos adelantado en la sección Introducción que el comportamiento cooperativo no es evolutivamente estable al interior de los grupos.
Por otro lado, hemos visto en la sección Metodología una extensión del modelo de Ole Peters que incluye todas las posibles estrategias $e$, y hemos visto que la estrategia analizada por Ole Peters está individualmente mal adaptada al ambiente.

\subsection{Fitness de los comportamientos cooperadores y desertores}

Para empezar, analicemos lo que ocurre a los comportamientos desertores $c=0$ y cooperadores $c=1$ en poblaciones enteramente desertoras y enteramente cooperadoras.
La tasa de crecimiento característica de los agentes desertores la podemos calcular utilizando la media geomética (ecuación \ref{eq:geometric_mean}).
%
\begin{equation}\label{eq:des_temporal_average}
P(a(1\dots T)|e, c_0) = \prod_t^T P(a(t)|e,c_0) \approx  P(a=1|e,c_0)^{p^*} P(a=0|e,c_0)^{1-p^*} = \overline{f}(e,c_0)
\end{equation}
%
Con $p^*$ la probabilidad real de generación de éxitos.
La aproximación es una igualdad en el límite $\lim T \rightarrow \infty$.

% Parrafo

¿Cuál es la tasa de crecimiento caracterísitica de las estrategias cooperadoras?
En una población enteramente cooperativa la aptitud de los agentes depende del tamaño de la población $n$.
Supongamos que tenemos $n$ sujetos caracterizadas por el vector de estrategias $e = \{e_1, \dots, e_n\}$.
Cooperar significa que los sujetos, luego de tirar la moneda, dividen en partes iguales sus recursos con los miembros del grupo.
%
\begin{figure}[H]
\centering
\tikz{
    
    \node[latent, minimum size=0.9cm] (e1) {$e_i^{t}$};
    \node[latent, right=of e1] (e2) {$e_j^{t+1}$};
    \node[const, right=of e2] (e2n) {$P(e_j^{t+1}|e^{t}) = \frac{1}{|e^t|}$};
    \node[const, right=of e2, yshift=-1cm] (e2n) {$P(e_i^{t}) = \text{Prior}^t$};
    \node[const, right=of e2, yshift=-2cm] (e2n) {$P(a_i^t|e_i^{t}) = \text{Bernoulli}(a_i^t|e_i^t)$};
    
    \node[det, below=of e1] (a) {$a_i^{t}$};
    \plate {cooperacion} {(e1)(a)} {$ 1 \leq i \leq n$}; 
    \edge {e1} {a,e2};
    }
\caption{Extensión del Modelo de Ole Peters para el comportamiento cooperador en una población enteramente cooperadora.}
\label{fig:modelo_cooperativo}
\end{figure}
%
%Donde $\mathbb{I}(s_j^{t+1}\in s^{t})$ es la función indicadora que vale 1 cuando el sujeto $s_j$ forma parte del grupo y 0 cuando no forma parte del grupo.


Supongamos que tenemos una población de tres cooperadores, $n=3$, que comparten sus recursos.
Sea $a_i^t$ el resultado obtenido por el agente $i$ en el tiempo $t$.
En cada paso temporal, el tamaño de la población (o el posterior proporcional) de cooperadores es,
\begin{equation}
\begin{split}
P(e_j^{t+1}, a^t) &=\frac{1}{3} \text{Prior}^t  \overbrace{P(a_1^t|e_1^t)}^{\hfrac{\text{Likelohood}}{\text{individual 1}}} + \frac{1}{3} \text{Prior}^t  \overbrace{P(a_2^t|e_2^t)}^{\hfrac{\text{Likelohood}}{\text{individual 2}}}  + \frac{1}{3} \text{Prior}^t  \overbrace{P(a_3^t|e_3^t)}^{\hfrac{\text{Likelohood}}{\text{individual 3}}}  \\
&= \text{Prior}^t \underbrace{(\frac{1}{3} P(a_1^t|e_1^t) + \frac{1}{3} P(a_2^t|e_2^t) + \frac{1}{3} P(a_3^t|e_3^t))}_{f(a|e,c=1)\text{ fitness cooperativo}} = \text{Prior}^{t+1}
\end{split}
\end{equation}
%
Es decir, el likelihood cooperativo es el promedio artimético de los likelihood individuales y es el mismo para todos los miembros del grupo.
En cada paso temporal el posterior se genera como el producto del prior y el likelihood.
Más aún, el prior del tiempo $t+1$ va a ser el mismo para todos.
Esto significa que existe una independecia temporal entre eventos, que nos permite resumir el modelo probabilístico de la siguiente manera.
% %
% \begin{figure}[H]
% \centering
% \tikz{
%     
%     \node[det, xshift=1cm] (c) {$c$};
%     \node[const, right=of c] (cn) {$P(c) = 0.5$};
%     \node[const, right=of c, yshift=0.45cm] (nc) {Comportamiento: \ \ \ };
%     
%     \node[latent, xshift=-1cm] (e) {$e$};
%     \node[const, left=of e] (en) {$P(e) = \text{Beta}(1,1)$};
%     \node[const, left=of e, yshift=0.45cm] (ne) {Estrtategia: \ \ \ };
%     
%     \node[det, yshift=-1.5cm] (a) {$a^t$};
%     \node[const, right=of a] (an) {$P(a^t|e,n,c)$};
%     \node[const, left=of a] (na) {Aptitud: \ };
%     
%     \plate {eventos} {(an)(na)(a)} {$ 1 \leq t \leq T$}; 
%     \edge {c,e} {a};
%     }
% \caption{Extensión del Modelo de Ole Peters incluyendo todo el espacio de estrategias $e$, el comportamiento $c$ cooperativo o desertivo de la población, compactado las variables temporales $T$ y de tamaño $n$.}
% \label{fig:modelo_extendido_2}
% \end{figure}
% %
% Este modelo nos permite incluir al mismo el comportamiento $c$ cooperativo o desertivo de la población, todo el espacio de estrategias $e$, compactado las variables temporales $T$ y de tamaño $n$ de la población.
% El likelihood de la población desertora ya lo hemos derivado.
% Terminemos de ver el likelihood de la población cooperadora.

% Parrafo

Los posibles fitness cooperativos para la población de tamaño 3 son,
%
\begin{equation}
f(a|e,n=3,c=1) =
\begin{cases}
(1-e) & \text{ si } a = 0 \\
\frac{1}{3} e + \frac{2}{3} (1-e)  & \text{ si } a = 1 \\
\frac{2}{3} e + \frac{1}{3} (1-e)    & \text{ si } a = 2 \\
e & \text{ si } a = 3
\end{cases}
\end{equation}
%
Y en general, sea $n$ el tamaño de la población, $a$ la cantidad de éxitos, el fitness cooperativo es
\begin{equation}\label{eq:fitness_cooperador}
f(a|e,n,c=1) = \frac{a}{n} e + \frac{n-a}{n}(1-e)
\end{equation}
%
El fitness conjunto, luego de observar $T$ estados del ambiente, es
%
\begin{equation}
f(\bm{a}|e,n,c=1) = \prod^T_t f(a^t|e,n,c=1)
\end{equation}
%
Donde $\bm{a}$ es el vector de tamaño $T$ con la cantidad de éxitos obtenidos en cada caso.
La tasa de crecimiento característica de los agentes cooperadores la podemos calcular utilizando la media geomética~\ref{eq:geometric_mean},
%
\begin{equation}
\overline{f}(e,n,c=1) = \prod_{a=0}^n f(a|e,n,c=1)^{\text{Binomial}(a|n,p^*)}
\end{equation}
%
donde $p^*$ es la verdadera probabilidad de generación de los estados $a$.
Cuando la población es muy grande, $n\rightarrow \infty$, en cada ronda habrá invariantemente una proproción $p*$ que obtuvo éxito, por lo que el likelihood caracterísitico se reduce a,
%
\begin{equation}
\lim_{n\rightarrow \infty} \overline{f}(e,c=1) = p^* e + (1-p^*)(1-e)
\end{equation}
%
El likelihood temporal caracterísitico de una estrategia $e$ en una población cooperativa infinita es la esperanza, la cual es lineal respecto de la verdadera probabilidad de generación de los estados del ambiente.

%En el siguiente modelo hacemos explícito el tipo de comportamiento $c\in\{0,1\}$ del agente.
%La extensión del modelo de Ole Peters que realizamos en la sección Metodología (figura~\ref{fig:modelo_beta_binomial}) sólo analizamos el comportamiento desertor individual.

\subsection{La ventaja de la especialización}

Conociendo al tasa de crecimiento caracterísitica de la población cooperadora y desertora, podemos analizar qué ocurre con las diferentes estrategias en diferentes ambientes.
En la siguiente figura graficamos el likelihood característico individual (líneas continuas) y cooperativos (líneas punteadas) de tres estrategias ($e \in \{0.5, 0.75, 0.99\}$) para diferentes probabilidades de generación del ambiente.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/tasa-temporal-0.pdf}
    \end{subfigure}
    \caption{Likelihood característico bajo regímenes individuales (líneas continuas) y cooperativos infinitos (líneas punteadas) de tres estrategias ($e \in \{0.5, 0.75, 0.99\}$) en diferentes tipos de ambiente $p^*$.}
    \label{fig:fitness_temporal}
\end{figure}
%
La flecha representa la conclusión de Ole Peters que presentamos en la introducción, donde mostramos experimentalmente que en un ambiente que genera los estados con una probabilidad de $p^* = 0.5$, la estretgia $e=0.71$ pasa de una tasa de crecimiento individual equivalente a la media geométrica a una tasa de crecimiento cooperativa equialente a su media aritmética.
El punto rojo representa la conclusión que sacamos en la sección metodología, que en un ambiente con $p^*=0.71$ la estrategia individual mejor adaptada es $e=0.71$.

% Parrafo

Con esta imagen podemos sacar algunas conclusiones nuevas.
Arriba del punto rojo se encuentra el likelihood caracterísitica de la población cooperativa de la estrategia especialista $e=0.99$.

\begin{conclution}[La ventaja de la especialización]
La cooperación ofrece una ventaja a favor de las estrategias especialistas. Estrategias que individualmente están mal adaptadas al ambiente, cooperando superan incluso a la población cooperativa que individualmemte está bien adaptada.
\end{conclution}

Esta conclusión la hemos obtenido a partir de tasa de crecimiento caracterísitica de una población cooperativa infinita.
Para que sea una conclusión interesante este comportamiento debería ocurrir en poblaciones finitas, particularmente pequeñas.
En la siguiente figura graficamos las tasas de crecimiento caracterísitica de la estrategia especialista $e=0.99$ para poblaciones cooperativas de tamaño 1 a 5.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/tasa-temporal-1.pdf}
    \end{subfigure}
    \caption{
    Tasa de superviencia temporal de la estrategia especialista ($e=0.99$) en función del ambiente, para diferentes tamaños de población cooperativa (de 1 a 5).
    La línea punteada negra represeta la tasa de crecimiento de una población cooperativa inifinitamente grande.
    Las rectas grises se dejan como referencia visual de las estrtegias $e \in \{0.5, 0.71\}$ analizadas en la figura anterior.
    }
    \label{fig:multilevel-selection-1}
\end{figure}
%
Un población de tres agentes es suficiente para que la estrategia especialista mal adaptada individualmente, logre cooperativamente superar a la población cooperativa compuesta de estrategia individualmente bien adapatadas!
Es realmente extraordinario que un sistema tan simple como el que estamos analizando tenga conclusiones tan fudamentales para entender la complejidad de la vida.
El proceso multiplicativo al cuál está sujeto la vida favorece tanto la cooperación como la especialización.

% Parrafo

El nivel de especialización depende del tamaño de la población.
Para analizarlo, fijamos el ambiente en $p^* = 0.71$ y analizamos como varía la tasa de crecimiento caracterísitica cooperativa para todo el rango de estrategias para diferentes tamaños de población (de 1 a 5).
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/tasa-temporal-2.pdf}
    \end{subfigure}
    \caption{
    La tasa de crecimiento temporal de las estretgias para diferentes tamaño de población enteramente cooperativa (de 1 a 5) en un ambiente $p^*=0.71$.
    }
    \label{fig:multilevel-selection-1}
\end{figure}
%
Ele eje x representa las diferentes estrategias.
Cada una de las curvas representa un tamaño de población cooperativa.
Los puntos indican la estretgia óptima para el tamaño de la población.
Cuando la población tiene tamaño 1, la estrategia mejor adaptada es la que apuesta con la misma probjabilidad que el ambiente.
Pero rápidamente, a medida que aumentamos el tamaño de la población, la cooperación favorece a las estrategias especialistas hasta que en poblaciones de tamaño inifinto el nivel se alcanza un nivel de especialización total que logra la tasa de crecimiento máxima, que es equivalente a la probabilidad de generación de las aptitudes $p^*$.

\subsection{Selección multinivel}

Para concluir que existe una ventaja evolutiva a favor de la cooperación y la especialización hace falta demostrar que la cooperación, no sólo puede resisitir la invasión de mutantes desertores, sino que ella misma invadirá poblaciones de desertores una vez que aparece.
Para empezar, veamos qué ocurre en poblaciones de tamaño 2.

% 

En la introducción hemos visto que, si bien la deserción unilateral produce pérdidas en términos absolutos para el mismo agente desertor sin necesidad de introducir castigos, los mutantes desertores invadirán evolutivamente la población debido a que su tasa de crecimiento será mayor que la del agente cooperador.
¿Pero qué ocurre con las diferentes tipos de poblaciones?
Una vez que surge una población enteramente cooperadora, ¿ésta es capaz de invadir el resto de poblaciones no cooperadoras?.

% Parrafo

Para responder esta pregunta extenderemos el modelo bayesiano, incluyendo un nuevo nivel superior: el tipo de grupo.
En una población de tamaño 2 tenemos 4 configuraciones posibles: CC, CD, DC, DD.
Definiendo un prior uniforme sobre estas 4 configuraciones estaremos expresando que no tenemos preferencia sobre ninguna de ellas, las configuraciones compiten bajos mismas condiciones iniciales.
Esta distribución la podemos expresar de forma compacta mediante una variable $g$ que representa la cantidad de desertores que hay en el grupo,
%
\begin{align}
\centering
P(g) = \begin{tabular}{|c|c|c|c|}
        \hline
        $g=0$ & $g=1$ & $g=2$ \\ \hline
        $1/4$ & $1/2$ & $1/4$ \\ \hline
\end{tabular}
\end{align}
%
La variable de grupo $g$ determina la composición inicial de las estrategias coperativa al interior del grupo.
Los sujetos están caracterizados por su estrategia $e$, su comportamiento $c$ y su identidad $i$, $s_i=(e,c,i)$.
En el grupo $g=0$ está compuesto por dos estrategias cooperadoras, $s_1=(e,c=1,1)$ y $s_2=(e,c=1,2)$, el grupo $g=1$ está compuesto por una estrategia cooperadora y una desertora, $s_3=(e,c=1,3)$ y $s_4=(e,c=0,4)$, y el grupo $g=2$ enteramente desertor lo resumimos mediante un único agente desertor $s_5=(e,c=0,5)$
%
\begin{align}
\centering
P(s^0|g) = \begin{tabular}{|c|c|c|c|c|c|}
        \hline
        & $s^0_1$ & $s^0_2$ & $s^0_3$ &  $s^0_4$ & $s^0_5$ \\ \hline
       $g=0$ & $0.5$ & $0.5$ & $0$ &  $0$ & $0$  \\ \hline
       $g=1$ & $0$ & $0$ & $0.5$ & $0.5$ & $0$ \\ \hline
       $g=2$ & $0$ & $0$ & $0$ & $0$ & $1.0$ \\ \hline
\end{tabular}
\end{align}
%
En cada paso temporal, las estrategias cooperadoras ceden la mitad de los recursos a sus compañeras de grupo, y las estrategias desertoras mantienen para si todos los recursos.
%
\begin{align}
\centering
P(s^{t}|s^{t-1}) = \begin{tabular}{|c|c|c|c|c|c|}
        \hline
        & $s^t_1$ & $s^t_2$ & $s^t_3$ & $s^t_4$ & $s^t_5$ \\ \hline
       $s^{t-1}_1$ & $0.5$ & $0.5$ & $0$ &  $0$ & $0$  \\ \hline
       $s^{t-1}_2$ & $0.5$ & $0.5$ & $0$ & $0$ & $0$  \\ \hline \hline
       $s^{t-1}_3$ & $0$ & $0$ & $0.5$ & $0.5$ & $0$  \\ \hline
       $s^{t-1}_4$ & $0$ & $0$ & $0$ & $1.0$ & $0$  \\ \hline \hline
       $s^{t-1}_5$ & $0$ & $0$ & $0$ & $0$ & $1.0$  \\ \hline
\end{tabular}
\end{align}
%
En cada tiempo $t$ cada sujeto $i$ actualiza sus recursos en función del estado $a_i$.
Para simplificar, en vez de observar 5 valores, observamos solamente $a^t=(a^t_1, a^t_2)$, uno por cada miembro del grupo: el primer elemento es el valor que reciben los agentes impares, y el segundo los agentes pares. 
%
\begin{align}
\centering
P(a^{t}|s^{t}) \propto \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $a^t=(0,0)$ & $a^t=(1,0)$ & $a^t=(0,1)$ &  $a^t=(1,1)$  \\ \hline
       $s^{t}_1$ & $0.6$ & $1.5$ & $0.6$ & $1.5$ \\ \hline
       $s^{t}_2$ & $0.6$ & $0.6$ & $1.5$ & $1.5$  \\ \hline
       $s^{t}_3$ & $0.6$ & $1.5$ & $0.6$ & $1.5$  \\ \hline
       $s^{t}_4$ & $0.6$ & $0.6$ & $1.5$ & $1.5$ \\ \hline
       $s^{t}_5$ & $0.6$ & $1.5$ & $0.6$ & $1.5$ \\ \hline
\end{tabular}
\end{align}
Notar que la probabilidad está definida en términos proporcionales por lo que en este primer caso estamos analizamos agentes basados en la estrategia original propuesta por Ole Peters, $e=0.71$.

% Parrafo

Todas estas distribuciones de probabilidad condicional definen las probabilidad conjunta, que puede ser expresada en términos gráficos del siguiente modo,
%
\begin{figure}[H]
\centering
\tikz{
    \node[latent] (m) {$g$};

    \node[latent, right=of m] (e0) {$s^0$};
    
    \node[latent, right=of e0] (e1) {$s^1$};
    \node[latent, below=of e1] (r1) {$a^1$};
    
    \node[latent, right=of e1] (e2) {$s^2$};
    \node[latent, below=of e2] (r2) {$a^2$};
    
    \node[latent, right=of e2] (e3) {$s^3$};
    
    
    \edge {m} {e0};
    \edge {e0} {e1};
    \edge {e1} {r1,e2};
    \edge {e2} {r2,e3};
}
\caption{
Modelo bayesiano jerarquico para analizar la selección multinivel en procesos evolutivos.
}
\label{fig:modelo_grafico}
\end{figure}
%
Veamos cómo evoluciona el posterior de estos 3 grupos.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-6.pdf}
    \end{subfigure}
    \caption{
    Evolución del posterior de los grupos a medida que avanza en el tiempo.
    }
    \label{fig:multilevel-selection-6}
\end{figure}
%
La aparición de un grupo cooperador es suficiente para invadir poblaciones compuesta enteramente por grupos desertores y mixtos.
%
\begin{conclution}[La ventaja evolutiva de la cooperación]
La selección multinivel favorece a las estrategias cooperativas incluso con grupos de tamaño mínimo (dos).
La aparición de una relación de mutua cooperación invade poblaciones compuesta enteramente por grupos desertores y mixtos.
\end{conclution}
%
La ventaja evolutiva de la cooperación se extiende inmediatamente a poblaciones de tamaño mayor.
Si existe ventaja evolutiva en poblaciones de tamaño 2, más aun en poblaciones de mayor tamaño.
En el anexo hacemos una extensión de este modelo.

\section{Discusiones}

Es realmente extraordinario que un sistema tan simple como el que hemos analizando tenga conclusiones tan fudamentales para entender la complejidad de la vida.
La ventaja evolutiva de la cooperación y la especialización es consecuencia de la no-ergodicidad de los procesos multiplicativos a los que está sujeto la vida, por lo que ésta debe ser considerada la primera causa de las transiciones evolutivas mayores.

En este trabajo hemos utilizando la equivalencia entre la selección multinivel y la inferencia en modelos jerárquicos bayesianos para mostrar que las estrategias incondicionalmente cooperadoras se ven favorecidas evolutivamente a través de la selección grupal.
A su vez, mostramos que las estrategias individualmente mal adaptadas al ambiente (especialistas) logran mediante la cooperación en pequeña escala superar tanto a las estrategias bien adaptas individualmemte (generalistas), como a sus grupos cooperativos de tamaño infinito.

Mediante la propuesta metodológica de Czegel \cite{czegel2019-bayesianEvolution} (la selección multinivel como inferencia bayesiana jerárquica) resolvimos la demostración que le faltaba al modelo de Ole Peters (procesos multiplicativos ruidosos).
Y a su vez, con el modelo de Peters proveímos el ejemplo concreto que le faltaba a la propuesta metodológica de Czegel et al.
Ambas soluciones combinadas ofrecen una solución nueva al problema de las transiciones evolutivas mayores, que es más sencilla que las anterios (procesos multiplicativos ruidosos), basada en principios matemáticos bien fundados (la aplicación estrica de las reglas de la probabilidad).

Según Czegel \cite{czegel2019-bayesianEvolution} el isomorfismo entre los procesos evolutivos y la inferencia bayesiana multinivel,  ``support a learning theory-oriented narrative of evolutionary complexification: the complexity and depth of the hierarchical structure of individuality mirror the amount and complexity of data that have been integrated about the environment through the course of evolutionary history.''
Esta especulación es rechazada por el modelo de Ole Peters, el cual muestra que un simple proceso multiplicativo ruidoso favorece la selección multinivel de grupos cooperativos por sobre grupos con desertores.

Por otra parte, según \cite{peters-cooperation2019.03.04} su modelo ``paints a picture of cooperation driven by self-interest, not altruism, with cooperators outgrowing similar non-cooperators''.
Esta especulación es rechazada por la metodología de Czegel \cite{czegel2019-bayesianEvolution}, la cual muestra que si bien las estrategias cooperativas no son evolutivamente estables al interior de los grupos, estos se ven favorecidos gracias a la selección multinivel.

Además Czegel \cite{czegel2019-bayesianEvolution} dice que, ``This isomorphism allows for a natural interpretation of evolutionary transitions in individuality as \emph{learning the structure}''.
En este trabajo mostramos que lo que se aprende no es la estructura, sino que \emph{aprenden la dinámica}, en particular la ventaja que la no-ergódico de los procesos multiplicativos ofrece a favor de la cooperación y la especialización.

%La posibilidad de supervivencia y reproducción de una población depende no sólo del sistema de reciprocidad para la propagación del riesgo dentro de las poblaciones y entre las poblaciones de diferentes especies.

Hasta donde sabemos, nuestro trabajo sería el primero que desarrolla un modelo jerárquico bayesiano para resolver un problema de evolución bajo selección multinivel.

%Con la idea de analizar los efetos de la selección multinivel, traduicimos el modelo de Ole Peters a una distirbución de probabilidad jerárquica, la cual describiremos en términos gráficos y analizaremos utilizando solamente las reglas de la probabilidad.


{\footnotesize
\bibliographystyle{auxiliar/biblio/plos2015.bst}
\bibliography{auxiliar/biblio/biblio_notUrl.bib}
}

\section{Apéndice}

\subsection{Tasa de crecimiento en poblaciones mixtas-homogeneas}

%En el modelo anterior vimos qué ocurre con la selección de grupos (nivel 2) $g \in \{CC, CD, DD\}$ en una población caracterizada por una estrategia individual $e = 0.71$ en un ambiente $p^* = 0.5$.
%Sería interesante ver qué ocurre considerando simultaneamente todas las posibles poblaciones el espacio de estrategias, en todo el rango $e\in[0,1]$, tanto cooperativa como desertora
Vamos a generalizar el fitness para grupos mixtos.
% Las estrategias $e$ tiene un priori uniforme, $P(e) = \text{Beta}(1,1)$.
% Los grupos se caracterizan por la proporción de desertores $d$.
% Definimos un priori de los grupos en base a la cantidad de combinaciones, lo que puede ser calculado mediante la distribución $P(d) = \text{Binomial}(d|n,0.5)$.
% La probabilidad de encontrar al interior de un grupo un comportamiento desertor o cooperativo, $c\in \{0,1\}$ respectivamente, depende del tipo de grupo que estamos evaluando $P(c|d)=d^{(1-c)} (1-d)^{c}$.
Sea $N$ el tamaño de la población, y $n$ la cantidad de cooperadores en el grupo.
En cada tiempo $t$ definimos una única variable aptitud que será representada como un vector $\bm{a} \in (a_0, a_1)$, donde $a_0$ representa éxito o fracaso del jugador desertor, y $a_1$ representa la suma total de éxitos en la población de cooperadores de tamaño $n$.
% %
% \begin{figure}[H]
% \centering
% \tikz{
%     
%     \node[latent, xshift=1cm] (c) {$c$};
%     \node[const, right=of c] (cn) {$P(c|n,N) = \frac{n}{N}^{(1-c)} (1-d)^{c} \frac{n}{N} $};
%     \node[const, right=of c, yshift=0.45cm] (nc) {Comportamiento: \ \ \ };
%     
%     \node[latent, xshift=-1cm] (e) {$e$};
%     \node[const, left=of e] (en) {$P(e) = \text{Beta}(1,1)$};
%     \node[const, left=of e, yshift=0.45cm] (ne) {Estrtategia: \ \ \ };
%     
%     \node[latent, yshift=-1.5cm] (a) {$\bm{a}^t$};
%     \node[const, right=of a] (an) {$P(\bm{a}^t|c,e,n,N)$};
%     \node[const, left=of a] (na) {Aptitud: \ };
%     
%     \plate {aptitud_mixta} {(an)(na)(a)} {$ 1 \leq t \leq T$}; 
%     
%     \edge {c,e} {a};
%     }
% \caption{Modelo extendido}
% \label{fig:modelo_extendido}
% \end{figure}
% %
% 

% Parrafo

El tamaño de la población (o el posterior proporcional) para las estrategias cooperadoras en una población mixta es, 
%
\begin{equation}
P(\bm{a},e|n,N,c=1) = \frac{a_1}{N} e + \frac{n-a_1}{N}(1-e) = \frac{n}{N} f(a_1|e,n,c=1)
\end{equation}
%adora en poblaciones enteramente cooperado
donde $f(a|e,n,c=1)$ es el fitness cooperativos de la estrategia cooperadora en poblaciones enteramente cooperadora (ecuación~\ref{eq:fitness_cooperador}).
El tamaño de la población (o el posterior proporcional) luego de observar $T$ estados del ambiente, es
%
\begin{equation}
P(\bm{a}(1 \dots T),e|n,N,c=1) = \prod^T_t P(a_1(t),e|n,N,c=1)
\end{equation}
%
Cuando $T$ tiende a infinito, $T \rightarrow \infty$,
\begin{equation}
\lim_{T \rightarrow \infty}P(\bm{a}(1 \dots T),e|n,N,c=1) = \overline{f}(e,n,N,c=1)^T
\end{equation}
Por lo tanto, la tasa de crecimiento $\overline{f}$ es
\begin{equation} \label{eq:coop_temporal_average}
\overline{f}(e,n,N,c=1) = \prod_{a=0}^n P(a|e,n,N,c=1)^{\text{Binomial}(a|n,p^*)}
\end{equation}

%
donde $p^*$ es la verdadera probabilidad de generación de los estados $a$.
% 
% Como el cambio de los recursos no depende de $t$, en t pasos la población tiene un posterior caracterísitico
% \begin{equation}
% \overline{p}(e|n,N,c=1,\bm{a}(1\dots t))\propto \overline{f}(e,n,N,c=1)^t
% \end{equation}
% %
% donde el prior $p(e)$ podemos evitar ponerlo debido a que comenzamos con un distribución uniforme que no afecta la proporcionalidad.

% Parrafo

¿Cuál es el likelihood-fitness de los desertores?
Supongamos que primero juega y después recibe la parte del fondo común.
\begin{equation}
P(\bm{a}^{:t},e|n,N, c_0) =
\begin{cases}
 P(a_0(1)|e) & \ \  t=1 \\
 (P(\bm{a}^{:t-1},e|n,N,c_0) + P(\bm{a}^{:t-1}, e|n,N,c_1)) p(a_0(t)|e) & \ \  t>1
\end{cases}
\end{equation}
Donde $\bm{a}^{:t} = \bm{a}(1 \dots t)$ representa las primeras $t$ observaciones.
En $t=1$ actualiza sus recursos con el pago recibido $P(a_0(1)|e)$.
En $t>1$ incorpora la recursos recibidos del fondo común generado en el tiempo anterior, $ P(\bm{a}^{:t-1}, e|n,N,c_1)$, y finalmente actualiza sus recursos totales (la suma) con el pago $P(a_0(t)|e)$.

% Parrafo

Para simplificar la notación, hagamos los siguiemtes renombres, $\omega_D(t) = P(\bm{a}^{:T},e|n,N, c_0)$ y $\omega_C(t) = P(\bm{a}^{:T},e|n,N, c_1)$, los tamaños de las poblaciones en el tiempo $t$ o equivalentemente los posteriors proprcionales, y llamemos $r(t) =p(a_0(t)|e) $ al resultado obtenido en el tiempo $t$.
Veamos la forma que tiene el tamaño de la población en el tiempo 2,
\begin{align}
\omega_D(2) & = r(2) ( \omega_D(1) + \omega_C(1) ) \\
& = r(2)r(1) + r(2)\omega_C(1)
\end{align}
Y la forma que tiene el tamaño de la población en el tiempo $t=3$
\begin{align}
\omega_D(3) & = r(3) (\omega_D(2)+\omega_C(2)) \\
& = r(3) (r(2)r(1) + r(2)\omega_C(1) + \omega_C(2) ) \\
& = r(3)r(2)r(1) + r(3)r(2)\omega_C(1) + r(3)\omega_C(2) 
\end{align}

Acá ya podemos ver un patrón a partir del cual proponemos la siguiente hipótesis inductiva (HI).
\begin{equation} \label{eq:HI} \tag{HI} 
\omega_D(t) = \prod^t_{i=1} r(i) + \sum^{t-1}_{j=1} \omega_C(j)
\prod^t_{j<k} r(k)
\end{equation}

\paragraph{Caso Base.} Queremos ver que vale la \ref{eq:HI} en el tiempo $t=1$.
\begin{equation} 
\omega_D(1) \overset{\ref{eq:HI}}{=} \prod^1_{i=1} r(i) + \underbrace{\sum^{0}_{j=1} \omega_C(j) \prod^1_{j<k} r(k) }_{\text{vale $0$ por rango}} = r(1)
\end{equation}
Luego, vale el caso base.

\paragraph{Paso inductivo.} Dado que vale $\omega_D(t)$ quiero ver que vale $\omega_D(t+1)$: $\omega_D(t) \Rightarrow \omega_D(t+1)$

\begin{equation}
\begin{split}
\omega_D(t+1) &:= (\omega_D(t) + \omega_C(t)) r(t+1)  \\
& \overset{\ref{eq:HI}}{=} \bigg( \prod^t_{i=1} r(i) + \sum^{t-1}_{j=1} \omega_C(j) \prod^t_{j<k} r(k) + \omega_C(t) \bigg) r(t+1) \\
& = \bigg( \prod^t_{i=1} r(i) + \sum^{t}_{j=1} \omega_C(j) \prod^t_{j<k} r(k)\bigg) r(t+1) \\
& = r(t+1) \prod^t_{i=1} r(i) + r(t+1) \sum^{t}_{j=1}  \omega_C(j) \prod^t_{j<k} r(k) \\ 
& = \prod^{t+1}_{i=1} r(i) + \sum^{t}_{j=1}  \omega_C(j) \prod^{t+1}_{j<k} r(k) \\
\end{split}
\end{equation}
Luego, vale el paso inductivo. \\

% Parrafo 

Para determinar la tasa de crecimiento de las estrategia desertora en la población mixta, calculamos el cambio en el tamaño de la población luego de un paso temporal usando las tasas de crecimiento caracterísiticas 
\begin{equation}
\lim_{T \rightarrow \infty} \omega_C(T) = \overline{f}_c^T \ \ \ \  \ \ \lim_{T \rightarrow \infty} \prod^T_{t=1} r(t) = \overline{f}_d^T
\end{equation}
donde $\overline{f}_c$ y $\overline{f}_d$ están definidas en las ecuaciones \ref{eq:coop_temporal_average} y \ref{eq:des_temporal_average} respectivamente.
Luego, el tamaño de la población desertora lo podemos aproximar como 
\begin{equation}
\omega_D(t) = \overline{f}(e,c=0)^t + \sum^{t-1}_{j=1} \overline{f}(e,n,N,c=1)^j \overline{f}(e,c=0)^{t-j}
\end{equation}
Si reescalamos las tasas de crecimiento por un factor de $2.1$, recuperamos el juego propuesto por Ole Peters.
En la siguiente figura mostramos los recursos de los agentes desertor (azul) y cooperador (verde) en una población de tamaño 100 con un único desertor obtenida a partir del juego original propuesto por Ole Peters, y las curvas negras son las estimaciones temporales obtenidas con las tasas de crecimiento caracterísitica $\overline{f}_c$ y $\overline{f}_d$, de la estrategia $e=1.5/2.1$ reescladas por el factor $2.1$.
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-5.pdf}
    \end{subfigure}
    \caption{
    }
    \label{fig:multilevel-selection-5}
\end{figure}
Es interesante que la tasa de crecimiento del agente desertor es la misma que la tasa de crecimiento de los agentes cooperadores.
La tasa de crecimiento de los desertores se mantiene igual hasta que la tasa de crecimiento de la población cooperdora cae por debajo de la tasa de crecimiento de los desertores.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-7.pdf}
    \end{subfigure}
    \caption{
    }
    \label{fig:multilevel-selection-7}
\end{figure}
%

% Parrafo

Finalmente, en la siguiente figura mostramos qué estrategias se seleccionan para una población de tamaño 9 enteramente cooperativa (figura~\ref{fig:multilevel-selection-1}), con un agente desertor (figura~\ref{fig:multilevel-selection-2})y con dos agentes desertores (figura~\ref{fig:multilevel-selection-3}).
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-1.pdf}
    \caption{9/9}
    \label{fig:multilevel-selection-1}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-2.pdf}
    \caption{8/9}
    \label{fig:multilevel-selection-2}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-3.pdf}
    \caption{7/9}
    \label{fig:multilevel-selection-3}
    \end{subfigure}
    \caption{
    Posterior de las estrategias individuales para una población de 9 agentes con 0, 1 y 2 desertores (\ref{fig:multilevel-selection-1}, \ref{fig:multilevel-selection-2} y \ref{fig:multilevel-selection-3} respectivamente).
    Los valores negativo del eje x representa todo el rango de estrategias desertoras, y los valores positivos representan todo el rango de las estrategias cooperadoras.
    }
    \label{fig:multilevel-selection-123}
\end{figure}
%
Cuando la población es enteramente cooperadora o tiene un desertor, la estrategia predominante es especialista.
Cuando la población tiene más de una desertor, la estrategia predominante generalista.

% Parrafo

\paragraph{Posibles extensiones del modelo multinivel} Existen varias posibles extensiones al modelo probabilístico de selección multinivel.
\begin{itemize}
\item Agregar un prior con decaimiento exponencial al tamaño de la población para ver en que momento deja de convenir seguir agrandando la población.
\item Agregar mutaciones.
\item Considerar poblaciones heterogéneas, con diferente estrategias $e$ al interior de la población.
\end{itemize}



% 
% 
% \subsection{Tasa de crecimiento en poblaciones mixtas infinitas}
% 
% Las estrtegias que en una población infinita representan una proporción mayor a $0$ son a su vez infinitas.
% Sea $d$ la proporción de desertores y $1-d$ la proporción de cooperadores.
% 
% % 
% 
% La población cooperadora, al ser infinita, siempre crece como
% \begin{equation}
% \Delta w(C|e,d,a) = (1-d) \underbrace{(e\cdot a + (1-e)\cdot(1-a))}_{\text{Media de estados}}
% \end{equation}
% En cada paso las apuestas del conjunto de cooperadores crece como la media de estados, la cual se divide en partes iguales.
% Como el cambio en los recursos no depende de $t$, en t pasos la población tiene un tamaño de
% \begin{equation}
% w(C|e,d,a,t) = \Delta w(C|e,d,a)^t 
% \end{equation}
% 
% 
% 
% \begin{figure}[H]
%     \centering
%     \begin{subfigure}[b]{0.66\textwidth}
%     \includegraphics[width=\linewidth]{figures/pdf/multilevel-selection-4.pdf}
%     \end{subfigure}
%     \caption{
%     }
%     \label{fig:multilevel-selection-4}
% \end{figure}


\end{document}
