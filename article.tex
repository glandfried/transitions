\documentclass[a4paper,10pt]{article}
\usepackage[utf8]{inputenc}
\input{auxiliar/tex/encabezado.tex}
\input{auxiliar/tex/tikzlibrarybayesnet.code.tex}
\newif\ifen
\newif\ifes
\newcommand{\en}[1]{\ifen#1\fi}
\newcommand{\es}[1]{\ifes#1\fi}
\estrue

%opening
\title{Fundamentos de la complejidad de la vida}
\author{Gustavo Landfried}

\begin{document}

\maketitle

\begin{abstract}
La complejidad actual de la vida es consecuencia de una serie de transiciones evolutivas en las que entidades capaces de replicarse de forma independiente, cediendo algo de valor a las otras, pasan a formar unidades evolutivas de nivel superior.
Una condición preliminar crucial es la alineación de intereses y su persistencia en el tiempo.
En este artículo mostramos que estas condiciones se cumplen siempre debido a la no-ergodicidad de los procesos multiplicativos a los que está sujeto la vida: la secuencia de probabilidades de superviencia y reproducción.
En los procesos no-ergódicos, las fluctuaciones tienen un efecto negativo en la tasa de crecimiento individual a largo plazo, pero no en la tasa de crecimiento del valor esperado.
Al compartir recursos, las estrategias cooperadoras reducen sus fluctuaciones, aumentando sus tasas de crecimiento a largo plazo.
Si bien las estrategias que evitan compartir recursos pueden invadir por selección natural poblaciones enteramente cooperadoras, tal comportamiento aumenta al mismo tiempo sus fluctuaciones, afectando su propia tasa de crecimiento a largo plazo sin necesidad de introducir castigos.
Utilizando la equivalencia entre la evolución de una población jerárquica bajo selección multinivel y la inferencia en modelos jerárquicos bayesianos, mostramos que las estrategias incondicionalmente cooperadoras, sin ser estas evolutivamente estables al interior de los grupos, se ven favorecidas evolutivamente a través de la selección grupal.
La sinergia inherente a toda dinámica de reproducción y superviviencia junto con la selección multinivel de poblaciones cooperadoras, son el fundamento que explica la complejidad actual de la vida.
\end{abstract}

\section{Introducción}

En el último tercio de la historia del Universo, en algún momento hace aproximadamente 4500 millones de años, apareció en la tierra una forma de organización de la materia capaz de auto-replicarse.
El crecimiento de estos linajes en el tiempo, $\omega(t)$, estuvo gobernado por procesos multiplicativos,
%
\begin{equation} \label{eq:modelo_exponencial}
\omega(t) = \prod_i^t f(r_i)
\end{equation}
%
una secuencias estocástica de tasas de supervivencia y reproducción $f(\cdot)$ dependientes de un ambiente aleatorio $a$.
Supongamos que la naturaleza lanza una moneda,
%
\begin{equation} \label{eq:estrategia_base}
f(a) =
\begin{cases}
 1.5 & a = \text{ \en{Head}\es{Cara} } \\
 0.6 & a = \text{ \en{Tail}\es{Seca} }
\end{cases}
\end{equation}
%
si sale cara la población se reproduce un 50\% y si sale seca sobrevive el 60\%.

% Parrafo

Los errores producidos durante la replicación diversificaron las formas de vida, y las tasas de crecimiento de las diferentes estrategias favorecieron a aquellas mejor adaptadas al ambiente.
Desde aquel momento hasta entonces la vida adquirió una extraordinaria complejidad.
%
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.65\textwidth}
    \includegraphics[width=\linewidth]{auxiliar/images/biomass.jpg}
    \end{subfigure}
    \caption{
	Estimación de la distribución actual de la biomasa en la tierra realizada por Bar-On~\cite{barOn2018-biomass}.
    }
    \label{fig:cpr_individual}
\end{figure}
%
Esta complejidad es consecuencia de una serie de transiciones evolutivas~\cite{maynardSmith1995-majorTransitions} en las que las entidades capaces de replicarse de forma independiente, cediendo algo de valor a las otras, pasan a formar unidades evolutivas de nivel superior.
Algunos ejemplos paradigmáticos son la transición de las moléculas replicantes a las protocélulas, la endosimbiosis de las mitocondrias y los plastos por parte de las células eucariotas, la aparición de los organismos multicelulares.
¿Cómo se explica esta tendencia permanente de la vida en favor de la agregación cooperativa?

Sea $x_e$ la proporción de la estrategia $e$ en la población.
El modelo estándar en evolución, conocido como \emph{replicator dynamic} \cite{taylor1978-replicatorDynamic, schuster1983-replicatorDynamics, hofbauer2003-evolutionaryGameDynamics}, el cambio de la proporción está determinado por las tasas de crecimiento estimada $f_e$ de las estrategias,
\begin{equation} \label{eq:replicator_dynamic}
x_e^\prime = \frac{x_e f_e}{X}
\end{equation}
donde $X=\sum_i x_i f_i$ es una constante de normalización.
Una teoría de juegos dinámica observará cómo se mueve el vector de estado $x$ con el tiempo, y buscará los estados de equilibrio y examinará su estabilidad.
%La aptitud $f_i(x)$ sólo depende de las estrategias, y no del ambiente, porque en general la aptitud se define como la estimación de la tasa de crecimiento $r_i$.

\subsection{El problema de la estimación de la tasa de crecimiento}

La estimación de la tasa de crecimiento requiere considerar explícitamente la variablidad del ambiente y el tipo de proceso que genera esa variabilidad.

Buena parte de la literatura en evolución considera que la estimación correcta de la tasa de crecimiento es el valor esperado de las posibles trayectorias individuales de los recursos en el tiempo, $\omega(t)$.
Sea $\Omega_t$ el valor de todos los posibles trayectorias en el tiempo $t$, el valor esperado se obtiene pesando cada estado $\omega \in \Omega_t$ por la probabilidad de que ocurran $P(\omega)$
\begin{equation}
\langle \omega \rangle_t = \sum_{\omega \in \Omega_t} \omega \cdot  P(\omega)
\end{equation}

El valor esperado de la estrategia considerada en la ecuación \ref{eq:estrategia_base} es en los dos primeros pasos temporales de, 
\begin{equation}
\begin{split}
\langle \omega \rangle_1 & = 1.5 \cdot \frac{1}{2} + 0.6 \cdot  \frac{1}{2} = 1.05 \\ 
\langle \omega \rangle_2 &=  1.5^2 \cdot \frac{1}{4} + 2 (0.6 \cdot 1.5 \cdot \frac{1}{4} ) + 0.6^2 \cdot \frac{1}{4}= 1.05^2
\end{split}
\end{equation}

Según el valor esperado, la tasa de crecimiento estimada es $5\%$ por cada paso temporal, $\langle \omega \rangle_t = 1.05^t$.
Y efectivamente eso es lo que ocurre con el promedio de una muestra suficientemente grande de trayectoria individuales en el tiempo, $\omega(t)$, 
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_expectedValue.pdf}
    \end{subfigure}
    \caption{
    Promedio de los recursos individuales en el tiempo para diferentes tamaños de la población, en escala logarítimica.
    A medida que aumentamos el tamaño de la población, el promedio se acerca al valor esperado $\langle \omega \rangle_t = 1.05^t$.
    }
    \label{fig:cpr_individual}
\end{figure}

Sin embargo, el valor esperado no representa lo que lo le ocurre a los agentes en el tiempo. 
Individualmente, todas las trayectorias pierden a largo plazo a una tasa cercana al 5\%.
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_individual_trayectories.pdf}
    \caption{}
    \label{fig:ergodicity_individual_trayectories}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/pdf/ergodicity_individual_trayectories_longrun.pdf}
    \caption{}
    \label{fig:ergodicity_individual_trayectories_longrun}
    \end{subfigure}
    \caption{
    La recta negra representan el valor esperado.
    Figura \ref{fig:ergodicity_individual_trayectories}: tamaño de los recursos individuales en el tiempo, $ \log(\omega(t))$.
    Figura \ref{fig:ergodicity_individual_trayectories_longrun}: con suficiente tiempo todas las trayectorias individuales pegan a la recta azul. 
    }
    \label{fig:cpr_individual}
\end{figure}

La diferencia entre el valor esperado y lo que le ocurre a los agentes individuales en el tiempo es un problema bien conocido en mecánica estadística, llamado ``no-ergodicidad''~\cite{peters2019-ergodicityEconomics}.
Cuando un proceso es ergódico, las descripciones de su dinámica pueden remplazarse mediante el valor esperado, eliminado el tiempo de los modelos.
Sin embargo, las condiciones de para que un sistema cumpla con la hipótesis de ergodicidad son muy restrictivas.
Cuando las hipótesis no se cumplen nos vemos obligados a analizar directamente su dinámica. 

La dinámica evolutiva está gobernada por un procesos multiplicativos (eq.~\ref{eq:modelo_exponencial}), que en un cierto tiempo $t$ puede expresarse como,
\begin{equation}
\omega(t) = \prod^t_{i=1} f(r_i) = f(\text{cara})^{n_1} f(\text{seca})^{n_2}
\end{equation}

donde $n_1$ y $n_2$ representa la cantidad de ocurrencias de $f(\text{cara})$ y $f(\text{seca})$, con $n_1 + n_2 = t$.
Las trayectorias observadas en la figura \ref{fig:ergodicity_individual_trayectories} son variables, pero cuanto más tiempo observemos el sistema más suave se vuelven esas líneas (figura \ref{fig:ergodicity_individual_trayectories_longrun}).
En el límite, $T \rightarrow \infty$ todas las trayectoria individuales estarán determinadas por el mismo factor efectivo $\overline{f}$ por el que se multiplica los recursos $\omega(t)$ en cada iteración.
\begin{equation}
\begin{split}
\lim_{T \rightarrow \infty} \omega(T) & = \overline{f}^T \\
\left( \lim_{T \rightarrow \infty} \omega(T) \right)^{1/T} & =  \overline{f} \\
\lim_{T \rightarrow \infty} f(\text{cara})^{n_1/T} f(\text{seca})^{n_2/T} & 
 \end{split}
\end{equation}
Donde las frecuencias $\frac{n_1}{T}$ y $\frac{n_2}{T}$ en el límite $T \rightarrow \infty$ son iguales a las probabilidades de ocurrencia de los estados del sistema.
Por lo tanto, la mejor estimación de la tasa de crecimiento es,
\begin{equation}
\overline{f} = (1.5 \cdot 0.6)^{1/2} \approx 0.95
\end{equation}

Esta fórmula, que permite computar la tasa de crecimiento caracterísitica a largo plazo de las trayectorias individuales, se la conoce también como \emph{media geométrica} y ha sido usada previamente en la literatura de evolución~\cite{dempster1955-geometricMean}.
Una propiedad importante es que su valor siempre es menor que el promedio de estados.
Esto se debe a que en los procesos multiplicativos los impactos físicos de las pérdidas suelen ser más fuertes que los de las ganancias.
En el extremo, un único cero en la productoria alcanza para generar su extinción.

% Decimos que un proceso es ergódico si se cumple que,
% \begin{equation}
%  \underbrace{\lim_{T \mapsto \infty} \frac{1}{T} \sum_{t=1}^T \omega(t)}_{\text{Media temporal}}  = \underbrace{\sum_{\omega} \omega \cdot p(\omega)}_{\text{Media de estados}}
% \end{equation}
% 

\subsection{Cooperacion}

En los procesos no-ergódicos, las fluctuaciones tienen un efecto negativo en la tasa de crecimiento individual a largo plazo, pero no en la tasa de crecimiento del valor esperado.
Dado que la varianza realmente importa, una forma eficaz de reducirla es compartir los riesgos~\cite{yaari2010-cooperationEvolution, peters2015-evolutionaryAdvantageOfCooperation}.
%Parafraseando a Den Boer~\cite{denBoer1968-spreadingRisk}, la  supervivencia de una población depende de la distribución del riesgo dentro de la población y entre las poblaciones de diferentes especies.
Ole Peters~\cite{peters2015-evolutionaryAdvantageOfCooperation} considera las consecuencias que la distribución del riesgo de una estrategia cooperativa sencilla tiene sobre la tasa de crecimiento de los agentes.

Los agentes cooperadores simplemente reparten sus recursos en partes iguales luego de cada iteración.

\begin{figure}[H]
\centering
\scalebox{0.75}{
\tikz{

    \node[latent, minimum size=2cm ] (x1_0) {$\omega_1(t)$} ;
    \node[latent, below=of x1_0, minimum size=2cm ] (x2_0) {$\omega_2(t)$} ;

    \node[latent, right=of x1_0, minimum size=3cm ] (x1_0g) {$ \omega_1(t)\cdot f(r_1(t))$} ;
    \node[latent, right=of x2_0, minimum size=1.8cm, xshift=0.6cm , align=left] (x2_0g) {$\omega_2(t)\cdot$\\$f(r_2(t))$} ;
    
    \node[latent, right=of x1_0g, minimum size=3.8cm, yshift=-1.33cm, align=right] (x_0) {$\omega_1(t)\cdot f(r_1(t))$\\$+\omega_2(t)\cdot f(r_2(t))$ } ;
    
    \node[const, above=of x_0] (nx_0) {$\overbrace{\text{Pool}\hspace{2.5cm}\text{Share}}^{\text{\normalsize Cooperaci\'on}}$} ;
    
    \node[latent, right=of x1_0g, minimum size=2.5cm,  xshift=4.5cm] (x1_1) {$\omega_1(t+1)$ } ;
    \node[latent, below=of x1_1, minimum size=2.5cm, yshift=0.7cm] (x2_1) {$\omega_2(t+1)$ } ;
    
    \edge {x1_0} {x1_0g};
    \edge {x2_0} {x2_0g};
    \edge {x1_0g,x2_0g} {x_0};
    \edge {x_0} {x1_1,x2_1};
    
}
}
\caption{Estrategia cooperativa. Los agentes comienzan con los mismos recursos iniciales. Luego crecen independientemente de acuerdo con la ecuaci\'on \ref{}. Luego cooperan poniendo sus recursos en un fondo común, que finalmente es dividio en partes iguales.}
\label{fig:protocolo}
\end{figure}

Las poblaciones enteramente cooperadoras reducen sus fluctuaciones, lo que genera una aumento en la tasa de crecimiento de todos sus miembros.
En la figura \ref{fig:cpr_cooperation} mostramos la trayectoria de uno de los agentes cooperadores.
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\linewidth]{figures/cpr_cooperation.pdf}
    \end{subfigure}
    \caption{
    Tamaño logarítimico de los recursos de un individuo de una población con 33 agentes que comparten su riqueza luego de cada iteración.
    La recta negra que baja representa el promedio temporal, y la que sube el promedio de estados.
    }
    \label{fig:cpr_cooperation}
\end{figure}

Mediante la cooperación, las poblaciones de agentes logran acceder a tasas de crecimiento individuales equivalentes al promedio de estados del sistema, que en los sistemas no-ergódicos es siempre superior que el promedio temporal.

Ole Peters considera que este aumento de la tasa de crecimiento es demuestra la ventaja evolutiva de la cooperación, lo que propone como principal explicación de las transiciones evolutivas.
Sin embargo Ole Peters no analiza el problema de la deserción, quien dice ``our cooperators are unable to break the cooperative pact''.
No parece ser un problema menor, teniendo en cuenta la tentación que podría significar dejar de aportar al fondo común mientras se siguen recibiendo los beneficios de este.

\subsection{Estabilidad}

Para discutir este punto en detalle, analizamos las tasas de crecimiento de las estrategias cooperadora y desertora en un caso concreto.
La población más chica posible consiste de dos agentes.
En este caso las tasas de crecimiento temporal para las diferentes estrategias son:

\begin{equation}
   r(\cdot,\cdot) = \bordermatrix{ & C & D \cr
      C & \approx 1.0 & \approx 0.47 \cr
      D & \approx 0.95 & \approx 0.95 } 
\end{equation}

Un agente que ``decide'' desertar unilateralmente va a ver reducida su tasa de crecimiento de $r(C,C) = 1.0$ a $ r(D,C) = 0.95$.
Las estrategias desertoras, al evitar compartir sus recursos generan un aumento en sus propias fluctuaciones, afectando su tasa de crecimiento a largo plazo sin necesidad de introducir castigos.
Esto parecería apoyar la idea de Ole Peters de que la cooperación no es altruista sino que está impulsada por el interés personal.
Sin embargo, los agentes evolutivos no son agentes económicos, su frecuencia cambia en base a tasa de \emph{diferencial} de crecimiento.
Por más que la mutua cooperación sea mejor en términos absolutos, un mutante desertor tendrá una tasa de crecimiento mayor a la de su cpmañero cooperador ($r(D,C) = 0.95 > 0.47 = r(C,D)$), por lo que invadirá evolutivamente la población. 
Esto quiere decir que las estrategias cooperadoras no son evolutivamentes estables al interior de las poblaciones como proponía Ole Peters \footnote{La estructura de pagos coinicide con la matriz de pagos del Stag-Hunt. Los análisis que llegan a la conclusión de que las poblaciones enteramente cooperadoras son estrategias evolutivamente estables utilizan tasas de crecimiento de dinámicas aditivas en poblaciones infinitas, apartándose del modelo estandar de crecimiento exponencial.}.
Ole Peters no logra dar una respuesta completa que explique por qué las estrategias cooperadoras están favorecidas evolutivamente.

\subsection{Selección multinivel}

Una condición preliminar crucial para el desarrollo de las transiciones evolutivas es la alineación de intereses y su persistencia en el tiempo.
Ole Peters explica por qué es ventajoso para las individualidades formar un cuerpo cooperativo mayor en base a un principio fundamental: la naturaleza multiplicativa de los procesos evolutivos.
Para completar la explicación de las transiciones evolutivas, es necesario responder ¿Cómo pudo ser evolutivamente estable una organización de este tipo, una vez que evolucionó por primera vez?
El reto consiste en entender estas transiciones en términos darwinianos.

%, al ser no-ergódico, ofrece una ventaja física a favor de las estrategias cooperativas, las que se ven favorecidas evolutivamente a través de la selección multinivel.

La idea general de que las grandes transiciones evolutivas involucra selección tanto a nivel individual como a nivel grupal, está ampliamente aceptada.

La selección multinivel se clasifica de tipo 1 (MLS1), en el que los colectivos sontemporales, y de tipo 2 (MLS2) en la que los colectivos se reproducen indefinidamente siendo unidades evolutivas plenas.
%Una vez definidos los colectivos, se determina la tasa de crecimiento de las diferentes estretgias individuales y grupales.
En MLS1, la tasa de crecimiento grupal se interpreta como el tamaño de la población (i.e. tasa de crecimiento media de sus individuos).
En MLS2, la tasa de crecimiento de los grupos evolutivamente plenos puede depender de otros factores específicos, pero en general cuando el número de partículas por colectivo es considera constante, la aptitud relativa de los colectivos en MLS1 y MLS2 es idéntica.
Esto nos permitirá analizar al mismo tiempo lo que ocurre con ambos tipos de selección multinivel.
Veremos que incorporar los efectos de la selección multinivel es resulta crucial para entender las transiciones evolutivas en estos casos en los cuales la tasa de replicación de las entidades del nivel inferior y superior no está totalmente alineada.

\section{Metodología}

\subsection{Teoría de la probabilidad}

Actualmente, la teoría de la probabilidad es el enfoque más utilizado para representar incertidumbre asociada al conocimiento empírico.
Sus reglas han sido derivadas formalmente a partir de una gran cantidad de sistemas axiomáticos conceptualmente distintos e independientes entre sí~\cite{halpern2017-RAU2}, lo cual es uno de los punto fuertes a su favor.
Pero quizás más importante sea que su aplicación estricta garantiza maximizar la incertidumbre dada la información empírica (datos) y formal (modelos causales)~\cite{jaynes2003}.
Esta propiedad es la base del concepto de ``honestidad'', sobre el que se basa la validación intersubjetiva de las proposiciones de las ciencias empíricas~\cite{landfried2021-conocimientoEmpirico}.

Toda la teoría de la probabilidad puede resumirse en dos reglas: la~\ref{eq:sum_rule} y la~\ref{eq:product_rule}.
La \ref{eq:sum_rule} afirma que cualquier distribuci\'on marginal se puede obtener integrando o sumando la distribuci\'on conjunta.
\begin{equation} \label{eq:sum_rule}
 \tag{\en{sum rule}\es{regla de la suma}}
 P(x) = \sum_{y} P(x,y) \ \ \ \ \ \text{or} \ \ \ \ \ p(x) = \int p(x,y) \, dy
\end{equation}
Donde $P(\cdot)$ y $p(\cdot)$ representan distribuciones de probabilidad discretas y continuas respectivamente.
Adem\'as, la \ref{eq:product_rule} se\~nala que cualquier distribuci\'on conjunta puede ser expresada como el producto de distribuciones condicionales uni-dimensionles.
\begin{equation}\label{eq:product_rule}
\tag{\en{product rule}\es{regla del producto}}
 p(x,y) = p(x|y) p(y)
\end{equation}
De estas reglas obtenemos inmediatamente el~\ref{eq:bayes_theorem},
\begin{equation}\label{eq:bayes_theorem}
\tag{\en{Bayes' theorem}\es{Teorema de bayes}}
 p(y|x) = \frac{p(x|y)p(y)}{p(x)}
\end{equation}
El \ref{eq:bayes_theorem} actualiza de forma \'optima las creencia sobre las hip\'otesis, es decir maximizando la incertidumbre luego de haber incorporado la información provista por el modelo y los datos.


\subsection{Isomorfismo entre las teorías de la evolución y la probabilidad.}

\cite{harper2009-replicatorAsInference,shalizi2009-replicatorAsInference}

Existe un isomorfismo entre la teoría de la evolución (replicator dynamic) y la teoría de la probabilidad (teorema de bayes) que nos permite que traduzcamos los conceptos de una en términos de la otra.
Sea $e$ la estrategia, $r$ el resultado observable, 


\begin{equation} 
p(y|x) = \frac{p(x|y)p(y)}{p(x)}
\end{equation}

\begin{align*}
\centering
 \begin{tabular}{l|l}
  Teorema de Bayes & Replicator dynamic  \\ \hline
  Distribución a priori &
 \end{tabular}
\end{align*}


\subsection{Evolución de estrategias individuales}


La estrategia se actualiza individual propuesta 

\begin{equation}
x^{\prime} =
\begin{cases}
 1.5x & \text{ \en{Head}\es{Cara} } \\
 0.6x & \text{ \en{Tail}\es{Seca} }
\end{cases} \\
\end{equation}

\begin{equation}
 p(e|r) = \frac{p(r|e)p(e)}{p(r)}
\end{equation}



\begin{equation}
x^{\prime} \propto \frac{x^{\prime}}{1.5+0.6} \approx
\begin{cases}
 0.71x & \text{ \en{Head}\es{Cara} } \\
 0.29x & \text{ \en{Tail}\es{Seca} }
\end{cases}
\end{equation}

\begin{figure}[H]
\centering
\tikz{
    \node[latent] (e) {$e$};
    \node[const, right=of e] (en) {\ $p(e)=\text{Beta}(\alpha,\beta)$};
    \node[const, left=of e] (ne) {Estrategias: \ \ \ };
    
    
    \node[latent, below=of e] (r) {$r$};
    \node[const, right=of r] (rn) {$P(r|e) = \text{Binomial}(n,e)$};
    \node[const, left=of r] (nr) {Aptitud: \ \ \ };
    
    \edge {e} {r};
    }
\caption{}
\label{fig:modelo_beta_binomial}
\end{figure}

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin1.pdf}
    \caption{T = 0}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin2.pdf}
    \caption{T = 10}
    \end{subfigure}
    \begin{subfigure}[b]{0.32\textwidth}
    \includegraphics[width=\linewidth]{figures/coin3.pdf}
    \caption{T = 10^7}
    \end{subfigure}
    \caption{}
    \label{fig:estrategias_individuales}
\end{figure}

El proceso evolutivo selecciona las estrategias individuales que están mejor adaptadas al ambiente.
Si ambientes generan los estados con una probabilidad de $p=1.5/2.1\approx 0.71$ y $1-p$, entonces la estrategia individual mejor adaptada es la que en cada ronda apuesta $0.71$ de sus recursos al estado $A$ y $0.29$ de sus recursos al estado $B$.
Si el ambiente no cambia, la diversidad la evolución selecciona s


Si el ambiente no cambia, no hay ninguna ventaja a favor de la cooperación.
Las estrategias individuales que se adaptaron al ambiente, como las grupos cooperativos, tienen misma tasa de crecimiento temporal.
Si a eso le agregamos un costo por la coordinación cooperativa, entonces hay una ventaja a favor de las estrategias individuales.

La cooperación se ve favorecida cuando el ambiente cambia bruscamente, a una velocidad que impide a las estrategias individuales adaptarse lentamente.
En este caso las estrategias cooperativas muestran una ventaja frente a las estrategias individuales.


\subsection{Selección multinivel}

Según Szathm\'ary, co-autor del concepto de transiciones evolutivas \cite{szathmary1995-evolutionaryTransitions, szathmary2015-evolutionaryTransitions}, la evolución de una población jerárquica bajo selección multinivel es equivalente a la inferencia bayesiana en modelos jerárquicos bayesianos y las transiciones evolutivas en la individualidad, impulsadas por interacciones sinérgicas de aptitud, son equivalentes al aprendizaje de la estructura de los modelos jerárquicos a través de la comparación bayesiana de modelos~\cite{czegel2019-bayesianEvolution}.


\section{Resultados}

Aquí mostramos, basándonos en resultados anteriores que conectan el replicator dynamic y la inferencia bayesiana \cite{}, que si bien las estrategias cooperadoras no son evolutivamente estables al interior de los grupos, estas se ven favorecidas evolutivamente a través de la selección multinivel.

Con la idea de analizar los efetos de la selección multinivel, traduicimos el modelo de Ole Peters a una distirbución de probabilidad jerárquica, la cual describiremos en términos gráficos y analizaremos utilizando solamente las reglas de la probabilidad.

\subsection{Selección multinivel}

Primero definimos la probabilidad de los grupos mediante un prior uniforme.
Esto significa que no tenemos preferencia sobre ningún modelo.
Los modelos compiten bajos mismas condiciones iniciales.
Vamos a suponer la existencia de cuatro grupos.
Un grupo de 2 cooperadores, un grupo de 1 cooperador y 1 desertor, un grupos de desertores, y un grupo adicional con estrategias individuales bien adaptadas.

\begin{align}
\centering
P(r_{t}|e_{t}) \propto \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $r_t=(0,0)$ & $r_t=(0,1)$ & $r_t=(1,0)$ &  $r_t=(1,1)$  \\ \hline
       $e_{t}=1$ & $0.6$ & $1.5$ & $0.6$ & $1.5$ \\ \hline
       $e_{t}=2$ & $0.6$ & $0.6$ & $1.5$ & $1.5$  \\ \hline
       $e_{t}=3$ & $0.6$ & $1.5$ & $0.6$ & $1.5$  \\ \hline
       $e_{t}=4$ & $0.6$ & $0.6$ & $1.5$ & $1.5$ \\ \hline
       $e_{t}=5$ & $0.6$ & $1.5$ & $0.6$ & $1.5$ \\ \hline
       $e_{t}=6$ & $1.05$ & $1.05$ & $1.05$ & $1.05$  \\ \hline
\end{tabular}
\end{align}





\begin{align}
\centering
P(e_{t}|e_{t-1}) = \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $e_t=1$ & $e_t=2$ & $e_t=3$ &  $e_t=4$ & $e_t=5$ & $e_0=6$ \\ \hline
       $e_{t-1}=1$ & $0.5$ & $0.5$ & $0$ &  $0$ & $0$ & $0$ \\ \hline
       $e_{t-1}=2$ & $0.5$ & $0.5$ & $0$ & $0$ & $0$ & $0$ \\ \hline \hline
       $e_{t-1}=3$ & $0$ & $0$ & $0.5$ & $0.5$ & $0$ & $0$ \\ \hline
       $e_{t-1}=4$ & $0$ & $0$ & $0$ & $1.0$ & $0$ & $0$ \\ \hline \hline
       $e_{t-1}=5$ & $0$ & $0$ & $0$ & $0$ & $1.0$ & $0$ \\ \hline \hline
       $e_{t-1}=6$ & $0$ & $0$ & $0$ & $0$ & $0$ & $1.0$ \\ \hline
\end{tabular}
\end{align}




\begin{align}
\centering
P(g) = \begin{tabular}{|c|c|c|c|}
        \hline
        $g=1$ & $g=2$ & $g=3$  & $g=4$\\ \hline
        $1/4$ & $1/4$ & $1/4$ & $1/4$ \\ \hline
\end{tabular}
\end{align}

\begin{align}
\centering
P(e_0|g) = \begin{tabular}{|c|c|c|c|c|c|c|}
        \hline
        & $e_0=1$ & $e_0=2$ & $e_0=3$ &  $e_0=4$ & $e_0=5$ & $e_0=6$ \\ \hline
       $g=1$ & $0.5$ & $0.5$ & $0$ &  $0$ & $0$ & $0$ \\ \hline
       $g=2$ & $0$ & $0$ & $0.5$ & $0.5$ & $0$ & $0$ \\ \hline
       $g=3$ & $0$ & $0$ & $0$ & $0$ & $1.0$ & $0$ \\ \hline
       $g=4$ & $0$ & $0$ & $0$ & $0$ & $0$ & $1.0$ \\ \hline
\end{tabular}
\end{align}





\begin{figure}[H]
\centering
\tikz{
    \node[latent] (m) {$G$};

    \node[latent, right=of m] (e0) {$e_0$};
    
    \node[latent, right=of e0] (e1) {$e_1$};
    \node[latent, below=of e1] (r1) {$r_1$};
    
    \node[latent, right=of e1] (e2) {$e_2$};
    \node[latent, below=of e2] (r2) {$r_2$};
    
    \node[latent, right=of e2] (e3) {$e_3$};
    
    
    \edge {m} {e0};
    \edge {e0} {e1};
    \edge {e1} {r1,e2};
    \edge {e2} {r2,e3};
}
\caption{}
\label{fig:modelo_grafico}
\end{figure}




\subsection{Toda la imagen}

Lo que discutimos hasta ahora es el punto y la flecha de la siguiente figura \ref{}, correspondientes a la selección de la estrtegia individual (sección \ref{}) y la selección multinivel 


\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.66\textwidth}
    \includegraphics[width=\linewidth]{figures/coin4.pdf}
    \end{subfigure}
    \caption{}
    \label{fig:fitness_temporal}
\end{figure}




\section{Conclusiones}

En este trabajo, resolviendo dos problemas presentes en la literatura.
Con la propuesta metodológia de \cite{czegel2019-bayesianEvolution} (la selección multinivel como inferencia bayesiana jerárquica) resolvimos la demostración que le faltaba al modelo de Ole Peters (procesos multiplicativos ruidosos) que verifica que la cooperación está favorecida por la evolución.
Y a su vez, con el modelo de Peters proveímos el ejemplo concreto que le faltaba a la propuesta metodológica de \cite{czegel2019-bayesianEvolution}.
Ambas soluciones combinadas ofrecen una solución nueva al problema de las transiciones evolutivas mayores, que es más sencilla que las anterios (procesos multiplicativos ruidosos), basada en principios matemáticos bien fundados (la aplicación estrica de las reglas de la probabilidad).

Según \cite{czegel2019-bayesianEvolution} el isomorfismo entre los procesos evolutivos y la inferencia bayesiana multinivel,  ``support a learning theory-oriented narrative of evolutionary complexification: the complexity and depth of the hierarchical structure of individuality mirror the amount and complexity of data that have been integrated about the environment through the course of evolutionary history.''
Esta especulación es rechazada por el modelo de Ole Peters, el cual muestra que un simple proceso multicativo ruidoso favorece la selección multinivel de grupos cooperativos por sobre grupos con desertores.

Por otra parte, según \cite{peters} su modelo ``paints a picture of cooperation driven by self-interest, not altruism, with cooperators outgrowing similar non-cooperators''.
Esta especulación es rechazada por la metodología de czegel \cite{czegel2019-bayesianEvolution}, la cual muestra que si bien las estrategias cooperativas no son evolutivamente estables al interior de los grupos, estos se ven favorecidos gracias a la selección multinivel.

Además \cite{czegel2019-bayesianEvolution} dice que, ``This isomorphism allows for a natural interpretation of evolutionary transitions in individuality as \emph{learning the structure}''.
En este trabajo mostramos que lo que se aprende no es la estructura, sino que \textbf{aprenden la dinámica}, en particular el efecto no-ergódico de los procesos multiplicativos.

%La posibilidad de supervivencia y reproducción de una población depende no sólo del sistema de reciprocidad para la propagación del riesgo dentro de las poblaciones y entre las poblaciones de diferentes especies.


% La ciencia es una institución humana que tiene pretención de verdad, esto es de formular proposiciones que valgan para todas las personas, tanto intercultural como intersubjetivamente.
% Las ciencias formales validan sus proposiciones mediante teoremas, resultados derivados de aplicar las reglas internas a un sistema axiomático cerrado.
% Las ciencias empíricas, en cambio, deben validar sus proposiciones dentro de sistemas abiertos, lo que introduce siempre un grado de incertidumbre asociada.
% ¿Cuál es entonces la fuente de validez universal del conocimiento empírico?
% 
% Existe un principio epistemológico con validez intercultural, conocido como el \emph{principio de indiferencia}, afirma que si ante un espacio de hipótesis común llegamos a un acuerdo respecto de que no tenemos información previa, entonces estaremos de acuerdo en distribuir la creencia (aka incertidumbre) en partes iguales.
% Esta distribución de creencias, que permite el acuerdo intersubjetivo, la vamos a llamar creencia honesta.
% La fuente de validez universal se fundamenta en la maximización de la incertidumbre.
% ¿Se puede extender este principio para casos en los cuales tenemos información?
{\footnotesize
\bibliographystyle{auxiliar/biblio/plos2015.bst}
\bibliography{auxiliar/biblio/biblio_notUrl.bib}
}

\section{Apéndice}



\subsection{Tasa de crecimiento en poblaciones desertoras}

Sea $a$ la probabilidad del ambiente.
Sea $e$ la estrategia individual.
\begin{equation}
r(t) =
\begin{cases}
 e & \ \  1=B(a) \\
 (1-e) & \ \  0=B(a)
\end{cases}
\end{equation}


\subsection{Tasa de crecimiento en poblaciones cooperadoras}

En el modelo multinivel bayesiano vemos que ocurre con diferentes  poblaciones (Coop-Coop, Coop-Des, Des-Des) de una estrategia, $e = 0.71$, en un ambiente, $a = 0.5$.

Sería interesante extender ese modelo para que considere al mismo tiempo todas las posibes estrategias.

Cuando hacemos el análisis individual, la proproción de las estretgias la representamos con una distribución Beta y el fitness con una likelihood binomial.

Arrancamos con un Beta a priori uniforme

\begin{equation}
p(e_0) = \text{Beta}(1,1) \propto e^1 (1-e)^1 
\end{equation}

En el primer paso, cada individuo tira la moneda, y recibe un likelihood-fitness aleatorio.

\begin{equation}
p(e_1) \propto 
\begin{cases}
e^1 (1-e)^2 & \text{ si } r = 0 \\
e^2 (1-e)^1 & \text{ si } r = 1
\end{cases}
\end{equation}

Supongamos que tenemos una población de dos cooperadores, $N=3$, que comparten sus recursos.

\begin{equation}
p(e_1|r) \propto 
\begin{cases}
e^1 (1-e)^2 & \text{ si } r = (0,0,0) \\
\frac{1}{3} e^1 (1-e)^2 + \frac{2}{3} e^2 (1-e)^1  & \text{ si } r = (0,0,1) \\
 \dots \\
\frac{2}{3} e^2 (1-e)^1 + \frac{1}{3} e^1 (1-e)^2    & \text{ si } r = (0,1,1) \\
\dots \\
e^2 (1-e)^1 & \text{ si } r = (1,1,1)
\end{cases}
\end{equation}

Cuando ambos sacan el mismo resultado, la distribución Beta aumenta en un sólo punto, pues recibe como producto $(1-e)$ y $e$ respectivamente.
En el caso $r = (0,0,1)$ recibe como producto $(\frac{1}{3} + \frac{1}{3}e )$, y en el caso $r = (0,1,1)$ recibe como producto $(\frac{2}{3} - \frac{1}{3}e )$.
Veamos el primero,

\begin{equation}
\begin{split}
p(e_1) & \propto \frac{1}{3} e^1 (1-e)^2 + \frac{2}{3} e^2 (1-e)^1  \\
& =  e^1 (1-e)^1 ( \frac{1}{3} (1-e) +  \frac{2}{3} e)  \\
& =  e^1 (1-e)^1 (\frac{1}{3} + \frac{1}{3}e )
\end{split}
\end{equation}

Es decir, el primer posterior simplemente es el producto del prior por una de esas pendientes.
Y esa pendiente es compartida por todos los cooperadores.
Por lo que el segundo posterior va a ser nuevamente agregar como producto una de esas pendientes.
Es decir, en cada paso se van acumulando las pendietes.
Los posibles fitness de los cooperadores son entonces las pendientes, distribuidas como una Binomial. 


\begin{equation}
p(e_t) \propto \prod_i^t \text{pendiente}_i \propto (1-e)^{n_0} (\frac{1}{3} + \frac{1}{3}e )^{n_1} (\frac{2}{3} - \frac{1}{3}e )^{n_2} e^{n_3}
\end{equation}

Donde $n_i$ representa la cantidad de veces que el conjunto de cooperadores recibieron como pago cada una de las pendientes, con $\sum n_i = t$.
En el límite todas las trayectorias individuales estarán gobernadas por el mismo factor $\overline{f}$.

\begin{equation}
\begin{split}
\lim_{T \rightarrow \infty} p(e_T) & \propto \overline{f}^T \\
(\lim_{T \rightarrow \infty} p(e_T) )^{1/T} & \propto \overline{f} \\
(1-e)^{p(r=0)} (\frac{1}{3} + \frac{1}{3}e )^{p(r=1)} (\frac{2}{3} - \frac{1}{3}e )^{p(r=2)} (e)^{p(r=3)} & 
\end{split}
\end{equation}


\vspace{0.3cm}

\paragraph{Hipótesis inductiva} Generalización del fitness de los cooperadores sin desertores.
Sea $n$ el tamaño de la población, $r$ la cantidad de éxitos y $n-r$ la cantidad de fracasos, el fitness de los cooperadores es
\begin{equation}
f_c(r|n) = \frac{r}{n} e + \frac{n-r}{n}(1-e)
\end{equation}

La distribución de probabilidad del fitness de los cooperadores es
\begin{equation}
p(f_c(r|n)) = \text{Binomial}(r,n)
\end{equation}

y la probabilidad de las estrategias es
\begin{equation}
\overlie{f_c}(n) = \prod_{r=1}^n \left( \frac{r}{n} e + \frac{n-r}{n}(1-e) \right)^{p(f_c(r|n))}
\end{equation}



\subsection{Tasa de crecimiento poblaciones mixtas}

\todo[inline]{Generalizar intuición que ya tengo en papel}

\subsection{Tasa de crecimiento en poblaciones mixtas infinitas}

Las estrtegias que en una población infinita representan una proporción mayor a $0$ son a su vez infinitas.
Sea $d$ la proporción de desertores y $1-d$ la proporción de cooperadores.

\\

La población cooperadora, al ser infinita, siempre crece como
\begin{equation}
\Delta w(C|e,d,a) = (1-d) \underbrace{(e\cdot a + (1-e)\cdot(1-a))}_{\text{Media de estados}}
\end{equation}
En cada paso las apuestas del conjunto de cooperadores crece como la media de estados, la cual se divide en partes iguales.
Como el cambio en los recursos no depende de $t$, en t pasos la población tiene un tamaño de
\begin{equation}
w(C|e,d,a,t) = \Delta w(C|e,d,a)^t 
\end{equation}

¿Cuál es la tasa de crecimiento de los desertores?
Supongamos que primero juega y después recibe la parte del fondo común.
\begin{equation}
w(D|e,d,a,t) =
\begin{cases}
 r(1) & \ \  t=1 \\
 (w(D|e,d,a,t-1) + w(C|e,d,a,t-1)) r(t) & \ \  t>1
\end{cases}
\end{equation}
En $t=1$ actualiza sus recursos con el pago recibido $r(1)$.
En $t>1$ incorpora la recursos recibidos del fondo común generado en el tiempo anterior, $w(C|e,d,a,t-1)$, y finalmente actualiza sus recursos totales (la suma) con el pago $r(t)$.

\\

Veamos la forma que tiene el tamaño de la población en el tiempo
\begin{align}
w(D|t=2) & = r(2) (w(D|t=1) + w(C|t=1)) \\
& = r(2)r(1) + r(2)w(C|t=1))
\end{align}
Para simplificar la notación, hacemos implicitos los valores de $e$, $d$ y $a$.
Además, como el tamaño de los recursos del fondo común no dependen del tiempo

\begin{align}
w(D|t=3) & = r(3) (w(D|t=2)+w(C|t=2)) \\
& = r(3) (r(2)r(1) + r(2)w(C|t=1) + w(C|t=1) ) \\
& = r(3)r(2)r(1) + r(3)r(2)w(C|t=1) + r(3)w(C|t=2) 
\end{align}

Acá ya podemos ver un patrón a partir del cual proponemos la siguiente hipótesis inductiva (HI).
\begin{equation} \label{eq:HI} \tag{HI} 
w(D|t) = \prod^t_{i=1} r(i) + \sum^{t-1}_{j=1} w(C|t=j)
\prod^t_{j<k} r(k)
\end{equation}

\paragraph{Caso Base.} Queremos ver que vale la \ref{eq:HI} en el tiempo $t=1$.
\begin{equation} 
w(D|t=1) \overset{\ref{eq:HI}}{=} \prod^1_{i=1} r(i) + \underbrace{\sum^{0}_{j=1} \Delta w(C)^j \prod^1_{j<k} r(k) }_{\text{vale $0$ por rango}} = r(1)
\end{equation}
Luego, vale el caso base.

\paragraph{Paso inductivo.} Dado que vale $w(D|t)$ quiero ver que vale $w(D|t+1)$: $w(D|t) \Rightarrow w(D|t+1)$

\begin{equation}
\begin{split}
w(D|t+1) &:= (w(D|t) + w(C|t)) r(t)  \\
& \overset{\ref{eq:HI}}{=} \bigg( \big(\prod^t_{i=1} r(i) + \sum^{t-1}_{j=1} w(C|t) \prod^t_{j<k} r(k) \big)+ w(C|t) \bigg) r(t+1) \\
& = r(t+1) \prod^t_{i=1} r(i) + \sum^{t-1}_{j=1} \Delta w(C)^j r(t+1) \prod^t_{j<k} r(k) + w(C|t)  r(t+1) \\ 
& = \prod^{t+1}_{i=1} r(i) + \sum^{t-1}_{j=1} \Delta w(C)^j  \prod^{t+1}_{j<k} r(k) + w(C|t)  r(t+1)  \\
& = \prod^{t+1}_{i=1} r(i) + \sum^t_{j=1} \Delta w(C)^j  \prod^{t+1}_{j<k} r(k) 
\end{split}
\end{equation}
Luego, vale el paso inductivo. 




\end{document}
